[{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"Load useful packages","code":"library(hcaCaseStudies) library(hca) library(dplyr)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"project-information","dir":"Articles","previous_headings":"Setup","what":"Project information","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"Set project id Display information project","code":"project_id <- \"3c9d586e-bd26-4b46-8690-3faaa18ccf38\" project_information(project_id) ## Title ##   Highly Parallel Genome-wide Expression Profiling of Individual Cells ##   Using Nanoliter Droplets ## Contributors (unknown order; any role) ##   Joshua R Sanes, Rahul Satija, Alex K Shalek, Anindita Basu, James ##   Nemesh, Itay Tirosh, John J Trombetta, Aviv Regev, Ami Day, Evan Z ##   Macosko, Karthik Shekhar, Allison R Bialas, Steven A McCarroll, David ##   A Weitz, Nolan Kamitaki, Emily M Martersteck, Melissa Goldman ## Description ##   Cells, the basic units of biological structure and function, vary ##   broadly in type and state. Single-cell genomics can characterize cell ##   identity and function, but limitations of ease and scale have ##   prevented its broad application. Here we describe Drop-seq, a ##   strategy for quickly profiling thousands of individual cells by ##   separating them into nanoliter-sized aqueous droplets, associating a ##   different barcode with each cell's RNAs, and sequencing them all ##   together. Drop-seq analyzes mRNA transcripts from thousands of ##   individual cells simultaneously while remembering transcripts' cell ##   of origin. We analyzed transcriptomes from 44,808 mouse retinal cells ##   and identified 39 transcriptionally distinct cell populations, ##   creating a molecular atlas of gene expression for known retinal cell ##   classes and novel candidate cell subtypes. Drop-seq will accelerate ##   biological discovery by enabling routine transcriptional profiling at ##   single-cell resolution. ## doi: 10.1016/j.cell.2015.05.002 ## url: https://www.cell.com/fulltext/S0092-8674(15)00549-8 ## project: https://data.humancellatlas.org/explore/projects/3c9d586e-bd26-4b46-8690-3faaa18ccf38"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"conventions","dir":"Articles","previous_headings":"Setup","what":"Conventions","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"Statistics calculated locally use local.* column names, e.g., local.cellCount.","code":""},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"project-samples","dir":"Articles","previous_headings":"Data processing","what":"Project & samples","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"Create filter identify project Find project Samples associated project preliminary exploration sample descriptions Invariant information really telling us experiment…","code":"project_filter <- filters(projectId = list(is = project_id)) p <- projects(project_filter) p |> glimpse() ## Rows: 1 ## Columns: 14 ## $ projectId                   <chr> \"3c9d586e-bd26-4b46-8690-3faaa18ccf38\" ## $ projectTitle                <chr> \"Highly Parallel Genome-wide Expression Pr… ## $ genusSpecies                <chr> \"Mus musculus\" ## $ sampleEntityType            <chr> \"specimens\" ## $ specimenOrgan               <chr> \"eye\" ## $ specimenOrganPart           <chr> \"retina\" ## $ selectedCellType            <lgl> NA ## $ libraryConstructionApproach <chr> \"Drop-seq\" ## $ nucleicAcidSource           <chr> \"single cell\" ## $ pairedEnd                   <lgl> FALSE ## $ workflow                    <list> <\"analysis_protocol_normalization\", \"analy… ## $ specimenDisease             <chr> \"normal\" ## $ donorDisease                <chr> \"normal\" ## $ developmentStage            <chr> \"Theiler stage 28\" p |> pull(projectTitle) |> noquote() ## [1] Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets. s <- samples(project_filter, as = \"tibble_expanded\")  ## all informative columns s |>     select(where(column_is_not_all_NA)) |>     DT::datatable() ## informative 'specimen' or donorOrganisms columns s |>     select(starts_with(\"specimens\") | starts_with(\"donorOrganisms\")) |>     select(where(column_is_informative)) ## # A tibble: 7 × 2 ##   specimens.id donorOrganisms.id        ##   <chr>        <chr>                    ## 1 GSM1626794   P14_mouse_retina_donor_2 ## 2 GSM1626795   P14_mouse_retina_donor_3 ## 3 GSM1626799   P14_mouse_retina_donor_7 ## 4 GSM1626793   P14_mouse_retina_donor_1 ## 5 GSM1626797   P14_mouse_retina_donor_5 ## 6 GSM1626796   P14_mouse_retina_donor_4 ## 7 GSM1626798   P14_mouse_retina_donor_6 s |>     select(where(column_is_experimentwide)) |>     distinct() |>     glimpse() ## Rows: 1 ## Columns: 34 ## $ cellSuspensions.organ                 <chr> \"eye\" ## $ cellSuspensions.organPart             <chr> \"retina\" ## $ donorOrganisms.biologicalSex          <chr> \"unknown\" ## $ donorOrganisms.developmentStage       <chr> \"Theiler stage 28\" ## $ donorOrganisms.disease                <chr> \"normal\" ## $ donorOrganisms.donorCount             <int> 1 ## $ donorOrganisms.genusSpecies           <chr> \"Mus musculus\" ## $ donorOrganisms.organismAge.unit       <chr> \"day\" ## $ donorOrganisms.organismAge.value      <chr> \"14.0\" ## $ donorOrganisms.organismAgeRange       <list> <1209600, 1209600> ## $ fileTypeSummaries.fileSource          <chr> \"GEO\" ## $ fileTypeSummaries.isIntermediate      <lgl> FALSE ## $ projects.estimatedCellCount           <int> 44808 ## $ projects.projectId                    <chr> \"3c9d586e-bd26-4b46-8690-3faaa18… ## $ projects.projectShortname             <chr> \"HighlyParallelExpressionProfili… ## $ projects.projectTitle                 <chr> \"Highly Parallel Genome-wide Exp… ## $ protocols.instrumentManufacturerModel <chr> \"Illumina NextSeq 500\" ## $ protocols.libraryConstructionApproach <chr> \"Drop-seq\" ## $ protocols.nucleicAcidSource           <chr> \"single cell\" ## $ protocols.pairedEnd                   <lgl> FALSE ## $ protocols.workflow                    <list> <\"analysis_protocol_normalizatio… ## $ samples.accessible                    <lgl> TRUE ## $ samples.disease                       <chr> \"normal\" ## $ samples.effectiveOrgan                <chr> \"eye\" ## $ samples.organ                         <chr> \"eye\" ## $ samples.organPart                     <chr> \"retina\" ## $ samples.sampleEntityType              <chr> \"specimens\" ## $ samples.source                        <chr> \"specimen_from_organism\" ## $ sources.sourceId                      <chr> \"f57ff40f-c923-4356-a0f7-807c82b… ## $ sources.sourceSpec                    <chr> \"tdr:datarepo-00aa7019:snapshot/… ## $ specimens.disease                     <chr> \"normal\" ## $ specimens.organ                       <chr> \"eye\" ## $ specimens.organPart                   <chr> \"retina\" ## $ specimens.source                      <chr> \"specimen_from_organism\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"data-files","dir":"Articles","previous_headings":"Data processing","what":"Data files","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"project ‘fastq’ ‘txt.gz’ files. nine txt.gz files 7 samples – 7 ‘GSM’ sample files, two experiment-wide ‘GSE’ summary files Retrieve cache locally txt.gz files can extract data files, e.g., cell gene counts","code":"files0 <- files(project_filter) files0 ## # A tibble: 21 × 8 ##    fileId                    name  fileF…¹    size version proje…² proje…³ url   ##    <chr>                     <chr> <chr>     <dbl> <chr>   <chr>   <chr>   <chr> ##  1 d1f2fdc4-a8ec-4f1b-922e-… SRR1… fastq.… 2.68e10 2022-0… Highly… 3c9d58… http… ##  2 ec073678-a2cf-42f4-b795-… SRR1… fastq.… 2.17e10 2022-0… Highly… 3c9d58… http… ##  3 6373d4f0-6cde-4de2-81b3-… GSE6… txt.gz  5.31e 7 2022-0… Highly… 3c9d58… http… ##  4 f961d8f8-4acc-40b1-8c00-… GSE6… txt.gz  3.32e 8 2022-0… Highly… 3c9d58… http… ##  5 1846aca6-3e65-480d-b2bc-… GSM1… txt.gz  1.03e 7 2022-0… Highly… 3c9d58… http… ##  6 47a54560-93cb-4f85-89fe-… SRR1… fastq.… 2.47e10 2022-0… Highly… 3c9d58… http… ##  7 8b563c2a-57e2-4e51-bedf-… SRR1… fastq.… 9.48e 9 2022-0… Highly… 3c9d58… http… ##  8 594b651d-ee86-4c89-a2f7-… GSM1… txt.gz  8.83e 6 2022-0… Highly… 3c9d58… http… ##  9 c731fa4b-f63f-4d18-b18e-… GSM1… txt.gz  9.56e 6 2022-0… Highly… 3c9d58… http… ## 10 33c36b9e-5a07-430e-a360-… GSM1… txt.gz  5.58e 6 2022-0… Highly… 3c9d58… http… ## # … with 11 more rows, and abbreviated variable names ¹​fileFormat, ## #   ²​projectTitle, ³​projectId  files0 |>     count(fileFormat) ## # A tibble: 2 × 2 ##   fileFormat     n ##   <chr>      <int> ## 1 fastq.gz      12 ## 2 txt.gz         9  files1 <-     files0 |>     filter(fileFormat == \"txt.gz\") files1 |>     select(name) ## # A tibble: 9 × 1 ##   name                                                ##   <chr>                                               ## 1 GSE63472_P14Retina_merged_digital_expression.txt.gz ## 2 GSE63472_P14Retina_logDGE.txt.gz                    ## 3 GSM1626798_P14Retina_6.digital_expression.txt.gz    ## 4 GSM1626796_P14Retina_4.digital_expression.txt.gz    ## 5 GSM1626794_P14Retina_2.digital_expression.txt.gz    ## 6 GSM1626795_P14Retina_3.digital_expression.txt.gz    ## 7 GSM1626793_P14Retina_1.digital_expression.txt.gz    ## 8 GSM1626797_P14Retina_5.digital_expression.txt.gz    ## 9 GSM1626799_P14Retina_7.digital_expression.txt.gz file_path <-     files1 |>     filter(fileFormat == \"txt.gz\") |>     files_download() |>     unname()  files2 <-     files1 |>     left_join(tibble(         fileId = files1$fileId,         local.filePath = file_path     ), by = \"fileId\") files3 <-     files2 |>     geo_gsm_cell_count() |>     geo_gsm_gene_count()  files3 |>     select(name, local.cellCount, local.geneCount) ## # A tibble: 9 × 3 ##   name                                                local.cellCount local.ge…¹ ##   <chr>                                                         <int>      <int> ## 1 GSE63472_P14Retina_merged_digital_expression.txt.gz           49300      24658 ## 2 GSE63472_P14Retina_logDGE.txt.gz                              49300      24658 ## 3 GSM1626798_P14Retina_6.digital_expression.txt.gz               8280      20647 ## 4 GSM1626796_P14Retina_4.digital_expression.txt.gz               7650      20239 ## 5 GSM1626794_P14Retina_2.digital_expression.txt.gz               9000      20619 ## 6 GSM1626795_P14Retina_3.digital_expression.txt.gz               6120      20169 ## 7 GSM1626793_P14Retina_1.digital_expression.txt.gz               6600      20478 ## 8 GSM1626797_P14Retina_5.digital_expression.txt.gz               7650      19719 ## 9 GSM1626799_P14Retina_7.digital_expression.txt.gz               4000      20105 ## # … with abbreviated variable name ¹​local.geneCount"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"count-matrix","dir":"Articles","previous_headings":"Data processing","what":"Count matrix","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"GSE count matrices quite useful, know definitively map cell sample. compute count matrix concatenating counts GSM files.","code":"object_name <- \"local.countMatrix\" if (!cache_exists(project_id, object_name)) {     files3 |>         filter(startsWith(name, \"GSM\")) |>         geo_gsm_count_matrix() |>         cache_add(project_id, object_name) } count_matrix <- cache_read(project_id, object_name)  class(count_matrix)[1] # sparse matrix ## [1] \"dgCMatrix\" dim(count_matrix)      # genes x cells ## [1] 24760 49300 format(object.size(count_matrix), units = \"auto\") ## [1] \"439.5 Mb\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"singlecellexperiment","dir":"Articles","previous_headings":"Data processing","what":"SingleCellExperiment","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"Column (sample) data Experiment-wide metadata Assemble SingleCellExperiment (come)","code":"geo_id <-     pull(files3, \"name\") |>     strsplit(\"_\") |>     vapply(head, character(1), 1L) files4 <- bind_cols(files3, local.geoId = geo_id)  colData <-     s |>     select(where(column_is_informative)) |>     left_join(         bind_cols(files3, local.geoId = geo_id),         by = c(samples.id = \"local.geoId\")     ) colData |>     DT::datatable() metadata <-     s |>     select(where(column_is_experimentwide)) |>     distinct()  metadata |>     t() |>     DT::datatable()"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"anomalies","dir":"Articles","previous_headings":"","what":"Anomalies","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"donorOrganism.donorCount seems incorrect GSM1626793 (7, instead 1).","code":"file_filter <- filters(     projectId = list(is = project_id),     fileFormat = list(is = \"txt.gz\") ) files(file_filter, as = \"tibble_expanded\") |>     select(name, donorOrganisms.donorCount, files.size) ## # A tibble: 9 × 3 ##   name                                                donorOrganisms.d…¹ files…² ##   <chr>                                                            <int>   <int> ## 1 GSE63472_P14Retina_merged_digital_expression.txt.gz                  7  5.31e7 ## 2 GSE63472_P14Retina_logDGE.txt.gz                                     7  3.32e8 ## 3 GSM1626798_P14Retina_6.digital_expression.txt.gz                     1  1.03e7 ## 4 GSM1626796_P14Retina_4.digital_expression.txt.gz                     1  8.83e6 ## 5 GSM1626794_P14Retina_2.digital_expression.txt.gz                     1  9.56e6 ## 6 GSM1626795_P14Retina_3.digital_expression.txt.gz                     1  5.58e6 ## 7 GSM1626793_P14Retina_1.digital_expression.txt.gz                     7  8.00e6 ## 8 GSM1626797_P14Retina_5.digital_expression.txt.gz                     1  7.94e6 ## 9 GSM1626799_P14Retina_7.digital_expression.txt.gz                     1  6.64e6 ## # … with abbreviated variable names ¹​donorOrganisms.donorCount, ²​files.size"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-3c9d586e-bd26-4b46-8690-3faaa18ccf38.html","id":"sessioninfo","dir":"Articles","previous_headings":"","what":"sessionInfo()","title":"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets","text":"","code":"sessionInfo() ## R version 4.2.1 Patched (2022-10-03 r83008) ## Platform: aarch64-apple-darwin21.6.0 (64-bit) ## Running under: macOS Monterey 12.6 ##  ## Matrix products: default ## BLAS:   /Users/ma38727/bin/R-4-2-branch/lib/libRblas.dylib ## LAPACK: /Users/ma38727/bin/R-4-2-branch/lib/libRlapack.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] dplyr_1.0.10              hca_1.5.7                 ## [3] hcaCaseStudies_0.0.0.9004 BiocStyle_2.25.0          ##  ## loaded via a namespace (and not attached): ##  [1] Rcpp_1.0.9          lattice_0.20-45     tidyr_1.2.1         ##  [4] assertthat_0.2.1    rprojroot_2.0.3     digest_0.6.29       ##  [7] utf8_1.2.2          mime_0.12           BiocFileCache_2.5.0 ## [10] R6_2.5.1            RSQLite_2.2.18      evaluate_0.16       ## [13] httr_1.4.4          pillar_1.8.1        rlang_1.0.6         ## [16] curl_4.3.2          miniUI_0.1.1.1      whisker_0.4         ## [19] jquerylib_0.1.4     blob_1.2.3          Matrix_1.5-1        ## [22] DT_0.25             rmarkdown_2.16      pkgdown_2.0.6       ## [25] textshaping_0.3.6   desc_1.4.2          readr_2.1.3         ## [28] stringr_1.4.1       htmlwidgets_1.5.4   bit_4.0.4           ## [31] shiny_1.7.2         compiler_4.2.1      httpuv_1.6.6        ## [34] xfun_0.33           pkgconfig_2.0.3     systemfonts_1.0.4   ## [37] htmltools_0.5.3     tidyselect_1.1.2    tibble_3.1.8        ## [40] bookdown_0.29       fansi_1.0.3         tzdb_0.3.0          ## [43] dbplyr_2.2.1        later_1.3.0         rappdirs_0.3.3      ## [46] grid_4.2.1          jsonlite_1.8.2      xtable_1.8-4        ## [49] lifecycle_1.0.2     DBI_1.1.3           magrittr_2.0.3      ## [52] cli_3.4.1           stringi_1.7.8       cachem_1.0.6        ## [55] fs_1.5.2            promises_1.2.0.1    bslib_0.4.0         ## [58] ellipsis_0.3.2      filelock_1.0.2      ragg_1.2.3          ## [61] generics_0.1.3      vctrs_0.4.2         tools_4.2.1         ## [64] bit64_4.0.5         glue_1.6.2          purrr_0.3.5         ## [67] crosstalk_1.2.0     hms_1.1.2           fastmap_1.1.0       ## [70] yaml_2.3.5          BiocManager_1.30.18 memoise_2.0.1       ## [73] knitr_1.40          sass_0.4.2"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"Load useful packages","code":"library(hcaCaseStudies) library(hca) library(dplyr)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"project-information","dir":"Articles","previous_headings":"Setup","what":"Project information","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"Set project id Display information project","code":"project_id <- \"5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776\" project_information(project_id) ## Title ##   Single-cell Transcriptome Atlas of the Human Corpus Cavernosum ## Contributors (unknown order; any role) ##   Zheng Li, Brittney,D,Wick ## Description ##   Three normal tissue samples were obtained from the tumour margin of ##   penile carcinoma resection, all patients reported good stimulated ##   erections and early morning erections. The five ED CC tissues were ##   obtained from biopsy samples in artificial cavernous body ##   implantation, all the ED patients were diagnosed with organic ED ##   rather than psychological ED by the nocturnal penile tumescence (NPT) ##   and intracavernosal injection (ICI) tests. The DMED patients had a at ##   least 10-year history of type 1 diabetes and had good blood glucose ##   control before surgery. ## doi: NA ## url: NA ## project: https://data.humancellatlas.org/explore/projects/5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"conventions","dir":"Articles","previous_headings":"Setup","what":"Conventions","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"Statistics calculated locally use local.* column names, e.g., local.cellCount.","code":""},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"project-samples","dir":"Articles","previous_headings":"Data processing","what":"Project & samples","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"Create filter identify project Find project Samples associated project Columns either variable therefore describe sample-level information… …invariant reflect experiment-wide annotation","code":"project_filter <- filters(projectId = list(is = project_id)) p <- projects(project_filter) p |> glimpse() ## Rows: 1 ## Columns: 14 ## $ projectId                   <chr> \"5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776\" ## $ projectTitle                <chr> \"Single-cell Transcriptome Atlas of the Hu… ## $ genusSpecies                <chr> \"Homo sapiens\" ## $ sampleEntityType            <chr> \"specimens\" ## $ specimenOrgan               <chr> \"penis\" ## $ specimenOrganPart           <chr> \"corpus cavernosum penis\" ## $ selectedCellType            <lgl> NA ## $ libraryConstructionApproach <chr> \"10x 3' v3\" ## $ nucleicAcidSource           <chr> \"single cell\" ## $ pairedEnd                   <lgl> FALSE ## $ workflow                    <chr> \"analysis_protocol_1\" ## $ specimenDisease             <list> <\"erectile dysfunction\", \"normal\"> ## $ donorDisease                <list> <\"diabetes\", \"erectile dysfunction\", \"norm… ## $ developmentStage            <chr> \"human adult stage\" s <- samples(project_filter, as = \"tibble_expanded\") ## informative 'specimen' or 'donorOrganisms' columns s |>     select(starts_with(\"specimens\") | starts_with(\"donorOrganisms\")) |>     select(where(column_is_informative)) |>     glimpse() ## Rows: 8 ## Columns: 4 ## $ specimens.disease      <chr> \"normal\", \"erectile dysfunction\", \"normal\", \"er… ## $ specimens.id           <chr> \"GSM6255907\", \"GSM6255912\", \"GSM6255909\", \"GSM6… ## $ donorOrganisms.disease <list> \"normal\", \"erectile dysfunction\", \"normal\", \"e… ## $ donorOrganisms.id      <chr> \"donor_1\", \"donor_6\", \"donor_3\", \"donor_4\", \"do…  s |>     count(specimens.id, specimens.disease) ## # A tibble: 8 × 3 ##   specimens.id specimens.disease        n ##   <chr>        <chr>                <int> ## 1 GSM6255907   normal                   1 ## 2 GSM6255908   normal                   1 ## 3 GSM6255909   normal                   1 ## 4 GSM6255910   erectile dysfunction     1 ## 5 GSM6255911   erectile dysfunction     1 ## 6 GSM6255912   erectile dysfunction     1 ## 7 GSM6255913   erectile dysfunction     1 ## 8 GSM6255914   erectile dysfunction     1 s |>     select(where(column_is_experimentwide)) |>     distinct() |>     glimpse() ## Rows: 1 ## Columns: 29 ## $ cellSuspensions.organ                 <chr> \"penis\" ## $ cellSuspensions.organPart             <chr> \"corpus cavernosum penis\" ## $ donorOrganisms.biologicalSex          <chr> \"male\" ## $ donorOrganisms.developmentStage       <chr> \"human adult stage\" ## $ donorOrganisms.donorCount             <int> 1 ## $ donorOrganisms.genusSpecies           <chr> \"Homo sapiens\" ## $ fileTypeSummaries.fileSource          <chr> \"GEO\" ## $ fileTypeSummaries.isIntermediate      <lgl> FALSE ## $ projects.estimatedCellCount           <int> 37892 ## $ projects.laboratory                   <chr> \"Human Cell Atlas Data Coordinat… ## $ projects.projectId                    <chr> \"5b910a43-7fb5-4ea7-b9d6-43dbd1b… ## $ projects.projectShortname             <chr> \"AtlasOfTheHumanCorpusCavernosum\" ## $ projects.projectTitle                 <chr> \"Single-cell Transcriptome Atlas… ## $ protocols.instrumentManufacturerModel <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach <chr> \"10x 3' v3\" ## $ protocols.nucleicAcidSource           <chr> \"single cell\" ## $ protocols.pairedEnd                   <lgl> FALSE ## $ protocols.workflow                    <chr> \"analysis_protocol_1\" ## $ samples.accessible                    <lgl> TRUE ## $ samples.effectiveOrgan                <chr> \"penis\" ## $ samples.organ                         <chr> \"penis\" ## $ samples.organPart                     <chr> \"corpus cavernosum penis\" ## $ samples.sampleEntityType              <chr> \"specimens\" ## $ samples.source                        <chr> \"specimen_from_organism\" ## $ sources.sourceId                      <chr> \"3ab24677-3fed-42cd-b686-b82b294… ## $ sources.sourceSpec                    <chr> \"tdr:datarepo-465c9e6a:snapshot/… ## $ specimens.organ                       <chr> \"penis\" ## $ specimens.organPart                   <chr> \"corpus cavernosum penis\" ## $ specimens.source                      <chr> \"specimen_from_organism\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"data-files","dir":"Articles","previous_headings":"Data processing","what":"Data files","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"types files project ? Retrieve, list content, untar (temporary location; untar relatively quick) file. Annotate files1 object local file information can extract data files, e.g., cell gene counts","code":"files1 <- files(project_filter)  files1 ## # A tibble: 23 × 8 ##    fileId                    name  fileF…¹    size version proje…² proje…³ url   ##    <chr>                     <chr> <chr>     <dbl> <chr>   <chr>   <chr>   <chr> ##  1 48879b15-921c-49c0-907e-… SRR1… fastq.… 6.65e 9 2022-0… Single… 5b910a… http… ##  2 d6a8d77c-0039-41c9-b5a8-… SRR1… fastq.… 2.37e10 2022-0… Single… 5b910a… http… ##  3 76506d2b-4fe2-4130-ba99-… SRR1… fastq.… 2.23e10 2022-0… Single… 5b910a… http… ##  4 41ee77b8-d908-49cd-bb2f-… SRR1… fastq.… 6.09e 9 2022-0… Single… 5b910a… http… ##  5 f74c196a-8f82-4312-9646-… GSE2… tar     1.77e 8 2022-0… Single… 5b910a… http… ##  6 896cc476-88f0-42fe-97d9-… SRR1… fastq.… 2.33e10 2022-0… Single… 5b910a… http… ##  7 26eada48-7446-4e7b-8891-… SRR1… fastq.… 2.52e10 2022-0… Single… 5b910a… http… ##  8 5d4e02e5-da34-44ab-b2dd-… SRR1… fastq.… 2.40e10 2022-0… Single… 5b910a… http… ##  9 34488f52-d477-429a-94be-… SRR1… fastq.… 4.79e 9 2022-0… Single… 5b910a… http… ## 10 d39a1587-addf-4dd3-8ff9-… SRR1… fastq.… 2.42e10 2022-0… Single… 5b910a… http… ## # … with 13 more rows, and abbreviated variable names ¹​fileFormat, ## #   ²​projectTitle, ³​projectId  files1 |>     count(fileFormat) ## # A tibble: 2 × 2 ##   fileFormat     n ##   <chr>      <int> ## 1 fastq.gz      22 ## 2 tar            1  files1 <-     files1 |>     filter(fileFormat == \"tar\")  files1 |>     select(fileId, name, fileFormat) ## # A tibble: 1 × 3 ##   fileId                               name              fileFormat ##   <chr>                                <chr>             <chr>      ## 1 f74c196a-8f82-4312-9646-65655f4c0486 GSE206528_RAW.tar tar tar_file <-     files1 |>     filter(startsWith(name, \"GSE\")) |>     files_download() |>     unname()  ## what files are in the tar? tar_files <- untar(tar_file, list = TRUE) tar_files ## [1] \"GSM6255907_Normal_1_gene_martix.csv.gz\"   ## [2] \"GSM6255908_Normal_2_gene_matrix.csv.gz\"   ## [3] \"GSM6255909_Normal_3_gene_matrix.csv.gz\"   ## [4] \"GSM6255910_non-DM1_gene_matrix.csv.gz\"    ## [5] \"GSM6255911_non-DM2_gene_matrix.csv.gz\"    ## [6] \"GSM6255912_non-DM3_gene_matrix.csv.gz\"    ## [7] \"GSM6255913_Diabetes_1_gene_matrix.csv.gz\" ## [8] \"GSM6255914_Diabetes_2_gene_martix.csv.gz\"  ## untar to a temporary location exdir <- tempfile(); dir.create(exdir) untar(tar_file, exdir = exdir) files_local <- tibble(     fileId = files1$fileId,     local.fileName = tar_files,     local.filePath = file.path(exdir, tar_files) )  files2 <-     files1 |>     ## 1:many mapping from files1 to files_local     right_join(files_local, by = \"fileId\") |>     ## make fileId unique     mutate(fileId = paste(fileId, local.fileName, sep = \"-\")) count_matrix_files <-     files2 |>     geo_gsm_cell_count(sep = \",\") |>     geo_gsm_gene_count()  count_matrix_files |>     select(local.fileName, local.cellCount, local.geneCount) ## # A tibble: 8 × 3 ##   local.fileName                           local.cellCount local.geneCount ##   <chr>                                              <int>           <int> ## 1 GSM6255907_Normal_1_gene_martix.csv.gz              8357           33694 ## 2 GSM6255908_Normal_2_gene_matrix.csv.gz              5571           33694 ## 3 GSM6255909_Normal_3_gene_matrix.csv.gz             11644           33694 ## 4 GSM6255910_non-DM1_gene_matrix.csv.gz               5906           33694 ## 5 GSM6255911_non-DM2_gene_matrix.csv.gz               2853           33694 ## 6 GSM6255912_non-DM3_gene_matrix.csv.gz              11179           33694 ## 7 GSM6255913_Diabetes_1_gene_matrix.csv.gz            9058           33694 ## 8 GSM6255914_Diabetes_2_gene_martix.csv.gz           10425           33694"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"count-matrix","dir":"Articles","previous_headings":"Data processing","what":"Count matrix","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"Compute count matrix concatenating counts GSM files.","code":"object_name <- \"local.countMatrix\" if (!cache_exists(project_id, object_name)) {     count_matrix_files |>         geo_gsm_count_matrix(reader_function = readr::read_csv) |>         cache_add(project_id, object_name) } count_matrix <- cache_read(project_id, object_name)  class(count_matrix)[1] # sparse matrix ## [1] \"dgCMatrix\" dim(count_matrix)      # genes x cells ## [1] 33694 64993 format(object.size(count_matrix), units = \"auto\") ## [1] \"1.8 Gb\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"singlecellexperiment","dir":"Articles","previous_headings":"Data processing","what":"SingleCellExperiment","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"Column (sample) data Experiment-wide metadata Assemble SingleCellExperiment (come)","code":"geo_id <-     pull(count_matrix_files, \"name\") |>     strsplit(\"_R\") |>     vapply(head, character(1), 1L)  colData <-     s |>     select(where(column_is_informative)) |>     left_join(         bind_cols(count_matrix_files, local.geoId = geo_id),         by = c(samples.id = \"local.geoId\")     )  colData |>     DT::datatable() metadata <-     s |>     select(where(column_is_experimentwide)) |>     distinct()  metadata |>     glimpse() ## Rows: 1 ## Columns: 29 ## $ cellSuspensions.organ                 <chr> \"penis\" ## $ cellSuspensions.organPart             <chr> \"corpus cavernosum penis\" ## $ donorOrganisms.biologicalSex          <chr> \"male\" ## $ donorOrganisms.developmentStage       <chr> \"human adult stage\" ## $ donorOrganisms.donorCount             <int> 1 ## $ donorOrganisms.genusSpecies           <chr> \"Homo sapiens\" ## $ fileTypeSummaries.fileSource          <chr> \"GEO\" ## $ fileTypeSummaries.isIntermediate      <lgl> FALSE ## $ projects.estimatedCellCount           <int> 37892 ## $ projects.laboratory                   <chr> \"Human Cell Atlas Data Coordinat… ## $ projects.projectId                    <chr> \"5b910a43-7fb5-4ea7-b9d6-43dbd1b… ## $ projects.projectShortname             <chr> \"AtlasOfTheHumanCorpusCavernosum\" ## $ projects.projectTitle                 <chr> \"Single-cell Transcriptome Atlas… ## $ protocols.instrumentManufacturerModel <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach <chr> \"10x 3' v3\" ## $ protocols.nucleicAcidSource           <chr> \"single cell\" ## $ protocols.pairedEnd                   <lgl> FALSE ## $ protocols.workflow                    <chr> \"analysis_protocol_1\" ## $ samples.accessible                    <lgl> TRUE ## $ samples.effectiveOrgan                <chr> \"penis\" ## $ samples.organ                         <chr> \"penis\" ## $ samples.organPart                     <chr> \"corpus cavernosum penis\" ## $ samples.sampleEntityType              <chr> \"specimens\" ## $ samples.source                        <chr> \"specimen_from_organism\" ## $ sources.sourceId                      <chr> \"3ab24677-3fed-42cd-b686-b82b294… ## $ sources.sourceSpec                    <chr> \"tdr:datarepo-465c9e6a:snapshot/… ## $ specimens.organ                       <chr> \"penis\" ## $ specimens.organPart                   <chr> \"corpus cavernosum penis\" ## $ specimens.source                      <chr> \"specimen_from_organism\""},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776.html","id":"sessioninfo","dir":"Articles","previous_headings":"","what":"sessionInfo()","title":"Case Study: Single-cell Transcriptome Atlas of the Human Corpus Cavernosum","text":"","code":"sessionInfo() ## R version 4.2.1 Patched (2022-10-03 r83008) ## Platform: aarch64-apple-darwin21.6.0 (64-bit) ## Running under: macOS Monterey 12.6 ##  ## Matrix products: default ## BLAS:   /Users/ma38727/bin/R-4-2-branch/lib/libRblas.dylib ## LAPACK: /Users/ma38727/bin/R-4-2-branch/lib/libRlapack.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] dplyr_1.0.10              hca_1.5.7                 ## [3] hcaCaseStudies_0.0.0.9004 BiocStyle_2.25.0          ##  ## loaded via a namespace (and not attached): ##  [1] Rcpp_1.0.9          lattice_0.20-45     tidyr_1.2.1         ##  [4] assertthat_0.2.1    rprojroot_2.0.3     digest_0.6.29       ##  [7] utf8_1.2.2          mime_0.12           BiocFileCache_2.5.0 ## [10] R6_2.5.1            RSQLite_2.2.18      evaluate_0.16       ## [13] httr_1.4.4          pillar_1.8.1        rlang_1.0.6         ## [16] curl_4.3.2          miniUI_0.1.1.1      whisker_0.4         ## [19] jquerylib_0.1.4     blob_1.2.3          Matrix_1.5-1        ## [22] DT_0.25             rmarkdown_2.16      pkgdown_2.0.6       ## [25] textshaping_0.3.6   desc_1.4.2          readr_2.1.3         ## [28] stringr_1.4.1       htmlwidgets_1.5.4   bit_4.0.4           ## [31] shiny_1.7.2         compiler_4.2.1      httpuv_1.6.6        ## [34] xfun_0.33           pkgconfig_2.0.3     systemfonts_1.0.4   ## [37] htmltools_0.5.3     tidyselect_1.1.2    tibble_3.1.8        ## [40] bookdown_0.29       fansi_1.0.3         tzdb_0.3.0          ## [43] dbplyr_2.2.1        later_1.3.0         rappdirs_0.3.3      ## [46] grid_4.2.1          jsonlite_1.8.2      xtable_1.8-4        ## [49] lifecycle_1.0.2     DBI_1.1.3           magrittr_2.0.3      ## [52] cli_3.4.1           stringi_1.7.8       cachem_1.0.6        ## [55] fs_1.5.2            promises_1.2.0.1    bslib_0.4.0         ## [58] ellipsis_0.3.2      filelock_1.0.2      ragg_1.2.3          ## [61] generics_0.1.3      vctrs_0.4.2         tools_4.2.1         ## [64] bit64_4.0.5         glue_1.6.2          purrr_0.3.5         ## [67] crosstalk_1.2.0     hms_1.1.2           fastmap_1.1.0       ## [70] yaml_2.3.5          BiocManager_1.30.18 memoise_2.0.1       ## [73] knitr_1.40          sass_0.4.2"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"Load useful packages","code":"library(hcaCaseStudies) library(hca) library(dplyr)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"project-information","dir":"Articles","previous_headings":"Setup","what":"Project information","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"Set project id Display information project","code":"project_id <- \"8f630e0f-6bf9-4a04-9754-02533152a954\" project_information(project_id) ## Title ##   The immune cell atlas of human neuroblastoma ## Contributors (unknown order; any role) ##   Shenglin Mei, William,G,Sullivan ## Description ##   Our current knowledge of the different immune cells in neuroblastoma ##   is based on in vitro and in vivo studies mainly focusing on a single ##   cell type. Importantly, different studies have conveyed conflicting ##   results. Moreover, a comprehensive immune cell overview at the ##   single-cell level is still missing and understanding the complete ##   immune cell composition of neuroblastoma will be crucial for the ##   development of novel immunotherapeutics against the disease. In this ##   study, we performed single-cell RNA-sequencing on nineteen human ##   neuroblastoma samples coupled with multiplex immunohistochemistry and ##   survival analysis using additional datasets to provide a ##   comprehensive cellular and molecular immune cell landscape of human ##   neuroblastoma. Further, we contrasted our data with single-cell ##   RNA-sequencing data from normal fetal adrenal gland to characterize ##   cell-state changes from normal tissue to cancerous neuroblastoma. Our ##   analysis revealed 27 immune cell subtypes including distinct ##   subpopulations of myeloid, NK, B and T cells not identified in ##   neuroblastoma before. Several immune cell subtypes demonstrated a ##   survival benefit such as inflammatory monocytes, tumor associated ##   macrophages, various T cell populations, and Active NK cells. ##   Furthermore, in contrast to adult cancers and previous neuroblastoma ##   studies, we demonstrated an increase in inflammatory monocyte ##   cell-state when contrasting normal and tumor tissue, while we do not ##   observe differences in cytotoxicity and exhaustion score for ##   cytotoxic T cells, nor in Treg activity. Finally, we performed a ##   systemic receptor-ligand interaction analysis between tumor, stroma ##   and immune cells, where we showed the neuroblastoma tumor ##   microenvironment is highly complex and strongly correlated to ##   survival. In addition, we highlighted several interactions that we ##   suggest to be tested in future studies as a therapeutic option in ##   human neuroblastoma. Taken together, our study significantly adds to ##   the in depth understanding of the immune cell landscape, the ##   complexity of the tumor microenvironment and it provides a resource ##   for the development of novel immunotherapeutics for neuroblastoma. ## doi: 10.1016/j.xcrm.2022.100657 ## url: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9245004/ ## project: https://data.humancellatlas.org/explore/projects/8f630e0f-6bf9-4a04-9754-02533152a954"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"conventions","dir":"Articles","previous_headings":"Setup","what":"Conventions","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"Statistics calculated locally use local.* column names, e.g., local.cellCount.","code":""},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"project-samples","dir":"Articles","previous_headings":"Data processing","what":"Project & samples","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"Create filter identify project Find project Samples associated project preliminary exploration sample descriptions ’s easy summarize information sammples experiment, e.g., Invariant information really telling us experiment…","code":"project_filter <- filters(projectId = list(is = project_id)) p <- projects(project_filter) p |> glimpse() ## Rows: 1 ## Columns: 14 ## $ projectId                   <chr> \"8f630e0f-6bf9-4a04-9754-02533152a954\" ## $ projectTitle                <chr> \"The immune cell atlas of human neuroblast… ## $ genusSpecies                <chr> \"Homo sapiens\" ## $ sampleEntityType            <chr> \"specimens\" ## $ specimenOrgan               <list> <\"abdomen\", \"adrenal gland\", \"cervical spi… ## $ specimenOrganPart           <lgl> NA ## $ selectedCellType            <lgl> NA ## $ libraryConstructionApproach <chr> \"10x 3' v2\" ## $ nucleicAcidSource           <chr> \"single cell\" ## $ pairedEnd                   <lgl> FALSE ## $ workflow                    <chr> \"analysis_protocol_1\" ## $ specimenDisease             <chr> \"neuroblastoma\" ## $ donorDisease                <chr> \"neuroblastoma\" ## $ developmentStage            <list> <\"child stage\", \"infant stage\"> s <- samples(project_filter, as = \"tibble_expanded\")  ## all informative columns s |>     select(where(column_is_not_all_NA)) |>     DT::datatable() ## informative 'specimen' or donorOrganisms columns s |>     select(starts_with(\"specimens\") | starts_with(\"donorOrganisms\")) |>     select(where(column_is_informative)) ## # A tibble: 19 × 6 ##    specimens.id specimens.organ      donorOrganisms.de…¹ donor…² donor…³ donor…⁴ ##    <chr>        <chr>                <chr>               <chr>   <chr>   <list>  ##  1 GSM4445619   abdomen              child stage         donor_… 83.0    <dbl>   ##  2 GSM4445608   adrenal gland        infant stage        donor_1 4.0     <dbl>   ##  3 GSM4445624   adrenal gland        infant stage        donor_… 4.0     <dbl>   ##  4 GSM4445610   adrenal gland        child stage         donor_3 82.0    <dbl>   ##  5 GSM6058206   adrenal gland        child stage         donor_… 60.0    <dbl>   ##  6 GSM4445623   adrenal gland        child stage         donor_… 128.0   <dbl>   ##  7 GSM4445622   adrenal gland        infant stage        donor_… 7.0     <dbl>   ##  8 GSM4445614   adrenal gland        child stage         donor_6 108.0   <dbl>   ##  9 GSM4445621   abdomen              child stage         donor_… 33.0    <dbl>   ## 10 GSM4445609   adrenal gland        infant stage        donor_2 18.0    <dbl>   ## 11 GSM4445613   thoracic spinal cord child stage         donor_5 48.0    <dbl>   ## 12 GSM4445616   abdomen              child stage         donor_8 63.0    <dbl>   ## 13 GSM4445615   cervical spinal cord infant stage        donor_7 23.0    <dbl>   ## 14 GSM4445612   adrenal gland        child stage         donor_… 111.0   <dbl>   ## 15 GSM4445618   sacral spinal cord   infant stage        donor_9 6.0     <dbl>   ## 16 GSM4445620   abdomen              child stage         donor_… 93.0    <dbl>   ## 17 GSM4445617   adrenal gland        child stage         donor_… 111.0   <dbl>   ## 18 GSM4445611   lumbar spinal cord   child stage         donor_4 138.0   <dbl>   ## 19 GSM6058205   femur                child stage         donor_… 100.0   <dbl>   ## # … with abbreviated variable names ¹​donorOrganisms.developmentStage, ## #   ²​donorOrganisms.id, ³​donorOrganisms.organismAge.value, ## #   ⁴​donorOrganisms.organismAgeRange s |>     count(specimens.organ, donorOrganisms.developmentStage) ## # A tibble: 8 × 3 ##   specimens.organ      donorOrganisms.developmentStage     n ##   <chr>                <chr>                           <int> ## 1 abdomen              child stage                         4 ## 2 adrenal gland        child stage                         6 ## 3 adrenal gland        infant stage                        4 ## 4 cervical spinal cord infant stage                        1 ## 5 femur                child stage                         1 ## 6 lumbar spinal cord   child stage                         1 ## 7 sacral spinal cord   infant stage                        1 ## 8 thoracic spinal cord child stage                         1 s |>     select(where(column_is_experimentwide)) |>     distinct() |>     glimpse() ## Rows: 1 ## Columns: 28 ## $ donorOrganisms.biologicalSex          <chr> \"unknown\" ## $ donorOrganisms.disease                <chr> \"neuroblastoma\" ## $ donorOrganisms.donorCount             <int> 1 ## $ donorOrganisms.genusSpecies           <chr> \"Homo sapiens\" ## $ donorOrganisms.organismAge.unit       <chr> \"month\" ## $ fileTypeSummaries.contentDescription  <chr> \"count matrix\" ## $ fileTypeSummaries.count               <int> 1 ## $ fileTypeSummaries.format              <chr> \"tar\" ## $ fileTypeSummaries.isIntermediate      <lgl> FALSE ## $ fileTypeSummaries.totalSize           <int> 147066880 ## $ projects.estimatedCellCount           <int> 46261 ## $ projects.laboratory                   <chr> \"Human Cell Atlas Data Coordinat… ## $ projects.projectId                    <chr> \"8f630e0f-6bf9-4a04-9754-0253315… ## $ projects.projectShortname             <chr> \"immuneCellAtlasOfNeuroblastoma\" ## $ projects.projectTitle                 <chr> \"The immune cell atlas of human … ## $ protocols.instrumentManufacturerModel <chr> \"Illumina NextSeq 500\" ## $ protocols.libraryConstructionApproach <chr> \"10x 3' v2\" ## $ protocols.nucleicAcidSource           <chr> \"single cell\" ## $ protocols.pairedEnd                   <lgl> FALSE ## $ protocols.workflow                    <chr> \"analysis_protocol_1\" ## $ samples.accessible                    <lgl> TRUE ## $ samples.disease                       <chr> \"neuroblastoma\" ## $ samples.sampleEntityType              <chr> \"specimens\" ## $ samples.source                        <chr> \"specimen_from_organism\" ## $ sources.sourceId                      <chr> \"004ee0a4-7672-4922-9ec2-9f1c4e1… ## $ sources.sourceSpec                    <chr> \"tdr:datarepo-cc58cf4d:snapshot/… ## $ specimens.disease                     <chr> \"neuroblastoma\" ## $ specimens.source                      <chr> \"specimen_from_organism\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"data-files","dir":"Articles","previous_headings":"Data processing","what":"Data files","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"project single ‘tar’ file archive Retrieve, list content, untar (temporary location; untar relatively quick) file. Annotate files1 object local file information can extract data files, e.g., cell gene counts","code":"files1 <- files(project_filter) files1 |>     select(name, fileFormat) ## # A tibble: 1 × 2 ##   name              fileFormat ##   <chr>             <chr>      ## 1 GSE147766_RAW.tar tar tar_file <-     files1 |>     files_download() |>     unname()  ## what files are in the tar? tar_files <- untar(tar_file, list = TRUE) tar_files ##  [1] \"GSM4445608_NB01.count.csv.gz\" \"GSM4445609_NB02.count.csv.gz\" ##  [3] \"GSM4445610_NB09.count.csv.gz\" \"GSM4445611_NB11.count.csv.gz\" ##  [5] \"GSM4445612_NB12.count.csv.gz\" \"GSM4445613_NB13.count.csv.gz\" ##  [7] \"GSM4445614_NB15.count.csv.gz\" \"GSM4445615_NB16.count.csv.gz\" ##  [9] \"GSM4445616_NB17.count.csv.gz\" \"GSM4445617_NB18.count.csv.gz\" ## [11] \"GSM4445618_NB19.count.csv.gz\" \"GSM4445619_NB20.count.csv.gz\" ## [13] \"GSM4445620_NB21.count.csv.gz\" \"GSM4445621_NB22.count.csv.gz\" ## [15] \"GSM4445622_NB23.count.csv.gz\" \"GSM4445623_NB24.count.csv.gz\" ## [17] \"GSM4445624_NB26.count.csv.gz\" \"GSM6058205_NB34.count.csv.gz\" ## [19] \"GSM6058206_NB37.count.csv.gz\"  ## untar to a temporary location exdir <- tempfile(); dir.create(exdir) untar(tar_file, exdir = exdir) files_local <- tibble(     fileId = files1$fileId,     local.fileName = tar_files,     local.filePath = file.path(exdir, tar_files) )  files2 <-     files1 |>     ## 1:many mapping from files1 to files_local     right_join(files_local, by = \"fileId\") |>     ## make fileId unique     mutate(fileId = paste(fileId, local.fileName, sep = \"-\")) files3 <-     files2 |>     geo_gsm_cell_count(sep = \",\") |>     geo_gsm_gene_count()  files3 |>     select(local.fileName, local.cellCount, local.geneCount) ## # A tibble: 19 × 3 ##    local.fileName               local.cellCount local.geneCount ##    <chr>                                  <int>           <int> ##  1 GSM4445608_NB01.count.csv.gz             949           33868 ##  2 GSM4445609_NB02.count.csv.gz            1361           33868 ##  3 GSM4445610_NB09.count.csv.gz            6623           33868 ##  4 GSM4445611_NB11.count.csv.gz           10267           33868 ##  5 GSM4445612_NB12.count.csv.gz            5191           33868 ##  6 GSM4445613_NB13.count.csv.gz           17287           33868 ##  7 GSM4445614_NB15.count.csv.gz            5488           33868 ##  8 GSM4445615_NB16.count.csv.gz            2763           33868 ##  9 GSM4445616_NB17.count.csv.gz            1608           33868 ## 10 GSM4445617_NB18.count.csv.gz            4667           33868 ## 11 GSM4445618_NB19.count.csv.gz            3217           33868 ## 12 GSM4445619_NB20.count.csv.gz             677           33868 ## 13 GSM4445620_NB21.count.csv.gz             465           33868 ## 14 GSM4445621_NB22.count.csv.gz            1075           33868 ## 15 GSM4445622_NB23.count.csv.gz            2707           33868 ## 16 GSM4445623_NB24.count.csv.gz            2973           33868 ## 17 GSM4445624_NB26.count.csv.gz            5288           33868 ## 18 GSM6058205_NB34.count.csv.gz            5327           32966 ## 19 GSM6058206_NB37.count.csv.gz            8347           32966"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"count-matrix","dir":"Articles","previous_headings":"Data processing","what":"Count matrix","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"compute count matrix concatenating counts GSM files.","code":"object_name <- \"local.countMatrix\" if (!cache_exists(project_id, object_name)) {     files3 |>         filter(startsWith(local.fileName, \"GSM\")) |>         geo_gsm_count_matrix(reader_function = readr::read_csv) |>         cache_add(project_id, object_name) } count_matrix <- cache_read(project_id, object_name)  class(count_matrix)[1] # sparse matrix ## [1] \"dgCMatrix\" dim(count_matrix)      # genes x cells ## [1] 33868 86280 format(object.size(count_matrix), units = \"auto\") ## [1] \"1.2 Gb\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"singlecellexperiment","dir":"Articles","previous_headings":"Data processing","what":"SingleCellExperiment","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"Column (sample) data Experiment-wide metadata Assemble SingleCellExperiment (come)","code":"geo_id <-     pull(files3, \"local.fileName\") |>     strsplit(\"_\") |>     vapply(head, character(1), 1L) files4 <- bind_cols(files3, local.geoId = geo_id)  colData <-     s |>     select(where(column_is_informative)) |>     left_join(         bind_cols(files3, local.geoId = geo_id),         by = c(samples.id = \"local.geoId\")     ) colData |>     DT::datatable() metadata <-     s |>     select(where(column_is_experimentwide)) |>     distinct()  metadata |>     t() |>     DT::datatable()"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"anomalies","dir":"Articles","previous_headings":"","what":"Anomalies","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"list contributors (2 identified) incomplete. NB34 NB37 gene counts different others","code":"files4 |>     count(local.geneCount) ## # A tibble: 2 × 2 ##   local.geneCount     n ##             <int> <int> ## 1           32966     2 ## 2           33868    17  files4 |>     filter(local.geneCount == 32966) |>     select(local.fileName, local.geneCount) ## # A tibble: 2 × 2 ##   local.fileName               local.geneCount ##   <chr>                                  <int> ## 1 GSM6058205_NB34.count.csv.gz           32966 ## 2 GSM6058206_NB37.count.csv.gz           32966"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-8f630e0f-6bf9-4a04-9754-02533152a954.html","id":"sessioninfo","dir":"Articles","previous_headings":"","what":"sessionInfo()","title":"Case Study: The immune cell atlas of human neuroblastoma","text":"","code":"sessionInfo() ## R version 4.2.1 Patched (2022-10-03 r83008) ## Platform: aarch64-apple-darwin21.6.0 (64-bit) ## Running under: macOS Monterey 12.6 ##  ## Matrix products: default ## BLAS:   /Users/ma38727/bin/R-4-2-branch/lib/libRblas.dylib ## LAPACK: /Users/ma38727/bin/R-4-2-branch/lib/libRlapack.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] dplyr_1.0.10              hca_1.5.7                 ## [3] hcaCaseStudies_0.0.0.9004 BiocStyle_2.25.0          ##  ## loaded via a namespace (and not attached): ##  [1] Rcpp_1.0.9          lattice_0.20-45     tidyr_1.2.1         ##  [4] assertthat_0.2.1    rprojroot_2.0.3     digest_0.6.29       ##  [7] utf8_1.2.2          mime_0.12           BiocFileCache_2.5.0 ## [10] R6_2.5.1            RSQLite_2.2.18      evaluate_0.16       ## [13] httr_1.4.4          pillar_1.8.1        rlang_1.0.6         ## [16] curl_4.3.2          miniUI_0.1.1.1      whisker_0.4         ## [19] jquerylib_0.1.4     blob_1.2.3          Matrix_1.5-1        ## [22] DT_0.25             rmarkdown_2.16      pkgdown_2.0.6       ## [25] textshaping_0.3.6   desc_1.4.2          readr_2.1.3         ## [28] stringr_1.4.1       htmlwidgets_1.5.4   bit_4.0.4           ## [31] shiny_1.7.2         compiler_4.2.1      httpuv_1.6.6        ## [34] xfun_0.33           pkgconfig_2.0.3     systemfonts_1.0.4   ## [37] htmltools_0.5.3     tidyselect_1.1.2    tibble_3.1.8        ## [40] bookdown_0.29       fansi_1.0.3         tzdb_0.3.0          ## [43] dbplyr_2.2.1        later_1.3.0         rappdirs_0.3.3      ## [46] grid_4.2.1          jsonlite_1.8.2      xtable_1.8-4        ## [49] lifecycle_1.0.2     DBI_1.1.3           magrittr_2.0.3      ## [52] cli_3.4.1           stringi_1.7.8       cachem_1.0.6        ## [55] fs_1.5.2            promises_1.2.0.1    bslib_0.4.0         ## [58] ellipsis_0.3.2      filelock_1.0.2      ragg_1.2.3          ## [61] generics_0.1.3      vctrs_0.4.2         tools_4.2.1         ## [64] bit64_4.0.5         glue_1.6.2          purrr_0.3.5         ## [67] crosstalk_1.2.0     hms_1.1.2           fastmap_1.1.0       ## [70] yaml_2.3.5          BiocManager_1.30.18 memoise_2.0.1       ## [73] knitr_1.40          sass_0.4.2"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"Load useful packages","code":"library(hcaCaseStudies) library(hca) library(dplyr)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"project-information","dir":"Articles","previous_headings":"Setup","what":"Project information","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"Set project id Display information project","code":"project_id <- \"923d3231-7295-4184-b3f6-c3082766a8c7\" project_information(project_id) ## Title ##   A Single-Cell Transcriptomic Atlas of Human Skin Aging ## Contributors (unknown order; any role) ##   Moshi Song, Nanze Yu, Zhiran Zou, Piu Chan, Concepcion Rodriguez ##   Esteban, Jing Qu, Si Wang, Xiao Long, Yaobin Jing, Juan Carlos ##   Izpisua Belmonte, Ting Chen, Qian Zhao, Guang-Hui Liu, Jiuzuo Huang, ##   Yifang He, Ami Day, Yandong Zheng, Shuai Ma, Weiqi Zhang ## Description ##   Skin undergoes constant self-renewal, and its functional decline is a ##   visible consequence of aging. Understanding human skin aging requires ##   in-depth knowledge of the molecular and functional properties of ##   various skin cell types. We performed single-cell RNA sequencing of ##   human eyelid skin from healthy individuals across different ages and ##   identified eleven canonical cell types, as well as six subpopulations ##   of basal cells. Further analysis revealed progressive accumulation of ##   photoaging-related changes and increased chronic inflammation with ##   age. Transcriptional factors involved in the developmental process ##   underwent early-onset decline during aging. Furthermore, inhibition ##   of key transcription factors HES1 in fibroblasts and KLF6 in ##   keratinocytes not only compromised cell proliferation, but also ##   increased inflammation and cellular senescence during aging. Lastly, ##   we found that genetic activation of HES1 or pharmacological treatment ##   with quercetin alleviated cellular senescence of dermal fibroblasts. ##   These findings provide a single-cell molecular framework of human ##   skin aging, providing a rich resource for developing therapeutic ##   strategies against aging-related skin disorders. ## doi: 10.1016/j.devcel.2020.11.002 ## url: https://www.sciencedirect.com/science/article/pii/S1534580720308777?via%3Dihub#! ## project: https://data.humancellatlas.org/explore/projects/923d3231-7295-4184-b3f6-c3082766a8c7"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"conventions","dir":"Articles","previous_headings":"Setup","what":"Conventions","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"Statistics calculated locally use local.* column names, e.g., local.cellCount.","code":""},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"project-samples","dir":"Articles","previous_headings":"Data processing","what":"Project & samples","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"Create filter identify project Find project Samples associated project Columns either variable therefore describe sample-level information… nine samples, ranging 18 76 years old. …invariant reflect experiment-wide annotation","code":"project_filter <- filters(projectId = list(is = project_id)) p <- projects(project_filter, as = \"tibble_expanded\") p |> glimpse() ## Rows: 1 ## Columns: 65 ## $ projectId                                      <chr> \"923d3231-7295-4184-b3f… ## $ cellSuspensions.organ                          <chr> \"skin of body\" ## $ cellSuspensions.organPart                      <lgl> NA ## $ cellSuspensions.selectedCellType               <lgl> NA ## $ cellSuspensions.totalCells                     <lgl> NA ## $ dates.aggregateLastModifiedDate                <chr> \"2022-08-12T12:07:52.99… ## $ dates.aggregateSubmissionDate                  <chr> \"2022-07-25T14:58:41.34… ## $ dates.aggregateUpdateDate                      <chr> \"2022-08-12T12:07:52.99… ## $ dates.lastModifiedDate                         <chr> \"2022-08-08T11:11:06.85… ## $ dates.submissionDate                           <chr> \"2022-07-25T14:58:41.34… ## $ dates.updateDate                               <chr> \"2022-08-08T11:11:06.85… ## $ donorOrganisms.biologicalSex                   <chr> \"female\" ## $ donorOrganisms.developmentStage                <list> <\"adolescent stage\", \"h… ## $ donorOrganisms.disease                         <chr> \"normal\" ## $ donorOrganisms.donorCount                      <int> 9 ## $ donorOrganisms.genusSpecies                    <chr> \"Homo sapiens\" ## $ donorOrganisms.id                              <list> <\"HRI077736\", \"HRI07773… ## $ donorOrganisms.organismAge.unit                <list> <\"year\", \"year\", \"year\"… ## $ donorOrganisms.organismAge.value               <list> <\"18.0\", \"22.0\", \"23.0\"… ## $ donorOrganisms.organismAgeRange                <list> <567648000, 567648000, … ## $ fileTypeSummaries.contentDescription           <chr> \"DNA sequence\" ## $ fileTypeSummaries.count                        <int> 72 ## $ fileTypeSummaries.fileSource                   <lgl> NA ## $ fileTypeSummaries.format                       <chr> \"fastq.gz\" ## $ fileTypeSummaries.isIntermediate               <lgl> NA ## $ fileTypeSummaries.matrixCellCount              <lgl> NA ## $ fileTypeSummaries.totalSize                    <dbl> 567869528915 ## $ projects.accessible                            <lgl> TRUE ## $ projects.contributors.contactName              <list> <\"Moshi,,Song\", \"Nanze… ## $ projects.contributors.correspondingContributor <list> <TRUE, TRUE, TRUE> ## $ projects.contributors.email                    <list> <\"qujing@ioz.ac.cn\", \"g… ## $ projects.contributors.institution              <list> <\"State Key Laboratory … ## $ projects.contributors.laboratory               <lgl> NA ## $ projects.contributors.projectRole              <chr> \"data curator\" ## $ projects.estimatedCellCount                    <int> 35678 ## $ projects.laboratory                            <lgl> NA ## $ projects.projectDescription                    <chr> \"Skin undergoes constan… ## $ projects.projectId                             <chr> \"923d3231-7295-4184-b3… ## $ projects.projectShortname                      <chr> \"AgingSkinAtlas\" ## $ projects.projectTitle                          <chr> \"A Single-Cell Transcr… ## $ projects.publications.doi                      <chr> \"10.1016/j.devcel.2020… ## $ projects.publications.officialHcaPublication   <lgl> TRUE ## $ projects.publications.publicationTitle         <chr> \"A Single-Cell Transcr… ## $ projects.publications.publicationUrl           <chr> \"https://www.sciencedir… ## $ projects.supplementaryLinks                    <chr> \"https://bigd.big.ac.cn… ## $ protocols.instrumentManufacturerModel          <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach          <chr> \"10x 3' v2\" ## $ protocols.nucleicAcidSource                    <chr> \"single cell\" ## $ protocols.pairedEnd                            <lgl> FALSE ## $ samples.disease                                <chr> \"normal\" ## $ samples.effectiveOrgan                         <chr> \"skin of body\" ## $ samples.id                                     <list> <\"HRS118996\", \"HRS11899… ## $ samples.organ                                  <chr> \"skin of body\" ## $ samples.organPart                              <lgl> NA ## $ samples.preservationMethod                     <lgl> NA ## $ samples.sampleEntityType                       <chr> \"specimens\" ## $ samples.source                                 <chr> \"specimen_from_organism\" ## $ sources.sourceId                               <chr> \"60e92fc4-5ca3-462e-aba… ## $ sources.sourceSpec                             <chr> \"tdr:datarepo-b6764413:… ## $ specimens.disease                              <chr> \"normal\" ## $ specimens.id                                   <list> <\"HRS118996\", \"HRS11899… ## $ specimens.organ                                <chr> \"skin of body\" ## $ specimens.organPart                            <lgl> NA ## $ specimens.preservationMethod                   <lgl> NA ## $ specimens.source                               <chr> \"specimen_from_organism\" s <- samples(project_filter, as = \"tibble_expanded\") ## informative 'specimen' or 'donorOrganisms' columns s |>     select(starts_with(\"specimens\") | starts_with(\"donorOrganisms\")) |>     select(where(column_is_informative)) ## # A tibble: 9 × 5 ##   specimens.id donorOrganisms.developmentStage donorOrganisms.id donor…¹ donor…² ##   <chr>        <chr>                           <chr>             <chr>   <list>  ## 1 HRS119004    human adult stage               HRI077744         76.0    <dbl>   ## 2 HRS118997    human adult stage               HRI077737         22.0    <dbl>   ## 3 HRS119001    human adult stage               HRI077741         48.0    <dbl>   ## 4 HRS118998    human adult stage               HRI077738         23.0    <dbl>   ## 5 HRS119002    human adult stage               HRI077742         70.0    <dbl>   ## 6 HRS119000    human adult stage               HRI077740         47.0    <dbl>   ## 7 HRS118996    adolescent stage                HRI077736         18.0    <dbl>   ## 8 HRS118999    human adult stage               HRI077739         44.0    <dbl>   ## 9 HRS119003    human adult stage               HRI077743         73.0    <dbl>   ## # … with abbreviated variable names ¹​donorOrganisms.organismAge.value, ## #   ²​donorOrganisms.organismAgeRange s |>     select(where(column_is_experimentwide)) |>     distinct() |>     glimpse() ## Rows: 1 ## Columns: 28 ## $ cellSuspensions.organ                 <chr> \"skin of body\" ## $ donorOrganisms.biologicalSex          <chr> \"female\" ## $ donorOrganisms.disease                <chr> \"normal\" ## $ donorOrganisms.donorCount             <int> 1 ## $ donorOrganisms.genusSpecies           <chr> \"Homo sapiens\" ## $ donorOrganisms.organismAge.unit       <chr> \"year\" ## $ fileTypeSummaries.contentDescription  <chr> \"DNA sequence\" ## $ fileTypeSummaries.count               <int> 8 ## $ fileTypeSummaries.format              <chr> \"fastq.gz\" ## $ projects.estimatedCellCount           <int> 35678 ## $ projects.projectId                    <chr> \"923d3231-7295-4184-b3f6-c308276… ## $ projects.projectShortname             <chr> \"AgingSkinAtlas\" ## $ projects.projectTitle                 <chr> \"A Single-Cell Transcriptomic At… ## $ protocols.instrumentManufacturerModel <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach <chr> \"10x 3' v2\" ## $ protocols.nucleicAcidSource           <chr> \"single cell\" ## $ protocols.pairedEnd                   <lgl> FALSE ## $ samples.accessible                    <lgl> TRUE ## $ samples.disease                       <chr> \"normal\" ## $ samples.effectiveOrgan                <chr> \"skin of body\" ## $ samples.organ                         <chr> \"skin of body\" ## $ samples.sampleEntityType              <chr> \"specimens\" ## $ samples.source                        <chr> \"specimen_from_organism\" ## $ sources.sourceId                      <chr> \"60e92fc4-5ca3-462e-aba9-7abb6e6… ## $ sources.sourceSpec                    <chr> \"tdr:datarepo-b6764413:snapshot/… ## $ specimens.disease                     <chr> \"normal\" ## $ specimens.organ                       <chr> \"skin of body\" ## $ specimens.source                      <chr> \"specimen_from_organism\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"data-files","dir":"Articles","previous_headings":"Data processing","what":"Data files","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"types files project ? 72 fastq files, summaries, count matrices easily constructed.","code":"files1 <- files(project_filter)  files1 |>     glimpse() ## Rows: 72 ## Columns: 8 ## $ fileId       <chr> \"f92336cb-679a-401c-bd08-7c23038066b9\", \"27680660-89be-48… ## $ name         <chr> \"HRR172200_f1.fastq.gz\", \"HRR172224_r2.fastq.gz\", \"HRR172… ## $ fileFormat   <chr> \"fastq.gz\", \"fastq.gz\", \"fastq.gz\", \"fastq.gz\", \"fastq.gz… ## $ size         <dbl> 6722186386, 4220794531, 14231056971, 4743045901, 77747310… ## $ version      <chr> \"2022-08-08T11:11:13.097000Z\", \"2022-08-08T11:11:15.38900… ## $ projectTitle <chr> \"A Single-Cell Transcriptomic Atlas of Human Skin Aging.\"… ## $ projectId    <chr> \"923d3231-7295-4184-b3f6-c3082766a8c7\", \"923d3231-7295-41… ## $ url          <chr> \"https://service.azul.data.humancellatlas.org/repository/…  files1 |>     count(fileFormat) ## # A tibble: 1 × 2 ##   fileFormat     n ##   <chr>      <int> ## 1 fastq.gz      72"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"row-sample-and-cell-annotations","dir":"Articles","previous_headings":"Data processing","what":"Row, sample, and cell annotations","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"don’t information row (gene) data. Column (sample & cell) data don’t cell data.","code":"row_data <- tibble() sample_data <-     ## from the hca sample annotation...     s |>     select(         where(column_is_informative) & where(is.atomic)     )     ## ...but no local computations, e.g.,gene and cell counts  sample_data ## # A tibble: 9 × 10 ##   entryId        dates…¹ dates…² dates…³ donor…⁴ donor…⁵ donor…⁶ fileT…⁷ sampl…⁸ ##   <chr>          <chr>   <chr>   <chr>   <chr>   <chr>   <chr>     <dbl> <chr>   ## 1 33e9b90c-216d… 2022-0… 2022-0… 2022-0… human … HRI077… 76.0    6.02e10 HRS119… ## 2 369c08ed-6350… 2022-0… 2022-0… 2022-0… human … HRI077… 22.0    6.12e10 HRS118… ## 3 81e094b0-4f77… 2022-0… 2022-0… 2022-0… human … HRI077… 48.0    7.56e10 HRS119… ## 4 bc687da8-5a6d… 2022-0… 2022-0… 2022-0… human … HRI077… 23.0    6.16e10 HRS118… ## 5 cb5c72f4-c71b… 2022-0… 2022-0… 2022-0… human … HRI077… 70.0    6.80e10 HRS119… ## 6 d5ad0e2f-f5f5… 2022-0… 2022-0… 2022-0… human … HRI077… 47.0    6.75e10 HRS119… ## 7 de52f033-0142… 2022-0… 2022-0… 2022-0… adoles… HRI077… 18.0    7.25e10 HRS118… ## 8 e06338f1-883c… 2022-0… 2022-0… 2022-0… human … HRI077… 44.0    5.10e10 HRS118… ## 9 e2fee266-cad1… 2022-0… 2022-0… 2022-0… human … HRI077… 73.0    5.03e10 HRS119… ## # … with 1 more variable: specimens.id <chr>, and abbreviated variable names ## #   ¹​dates.lastModifiedDate, ²​dates.submissionDate, ³​dates.updateDate, ## #   ⁴​donorOrganisms.developmentStage, ⁵​donorOrganisms.id, ## #   ⁶​donorOrganisms.organismAge.value, ⁷​fileTypeSummaries.totalSize, ## #   ⁸​samples.id"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"experiment-wide-metadata","dir":"Articles","previous_headings":"Data processing","what":"Experiment-wide metadata","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"","code":"sample_metadata <-     s |>     select(where(column_is_experimentwide) & !any_of(names(p))) |>     distinct()  metadata <- bind_cols(p, sample_metadata)  metadata |>     glimpse() ## Rows: 1 ## Columns: 66 ## $ projectId                                      <chr> \"923d3231-7295-4184-b3f… ## $ cellSuspensions.organ                          <chr> \"skin of body\" ## $ cellSuspensions.organPart                      <lgl> NA ## $ cellSuspensions.selectedCellType               <lgl> NA ## $ cellSuspensions.totalCells                     <lgl> NA ## $ dates.aggregateLastModifiedDate                <chr> \"2022-08-12T12:07:52.99… ## $ dates.aggregateSubmissionDate                  <chr> \"2022-07-25T14:58:41.34… ## $ dates.aggregateUpdateDate                      <chr> \"2022-08-12T12:07:52.99… ## $ dates.lastModifiedDate                         <chr> \"2022-08-08T11:11:06.85… ## $ dates.submissionDate                           <chr> \"2022-07-25T14:58:41.34… ## $ dates.updateDate                               <chr> \"2022-08-08T11:11:06.85… ## $ donorOrganisms.biologicalSex                   <chr> \"female\" ## $ donorOrganisms.developmentStage                <list> <\"adolescent stage\", \"h… ## $ donorOrganisms.disease                         <chr> \"normal\" ## $ donorOrganisms.donorCount                      <int> 9 ## $ donorOrganisms.genusSpecies                    <chr> \"Homo sapiens\" ## $ donorOrganisms.id                              <list> <\"HRI077736\", \"HRI07773… ## $ donorOrganisms.organismAge.unit                <list> <\"year\", \"year\", \"year\"… ## $ donorOrganisms.organismAge.value               <list> <\"18.0\", \"22.0\", \"23.0\"… ## $ donorOrganisms.organismAgeRange                <list> <567648000, 567648000, … ## $ fileTypeSummaries.contentDescription           <chr> \"DNA sequence\" ## $ fileTypeSummaries.count                        <int> 72 ## $ fileTypeSummaries.fileSource                   <lgl> NA ## $ fileTypeSummaries.format                       <chr> \"fastq.gz\" ## $ fileTypeSummaries.isIntermediate               <lgl> NA ## $ fileTypeSummaries.matrixCellCount              <lgl> NA ## $ fileTypeSummaries.totalSize                    <dbl> 567869528915 ## $ projects.accessible                            <lgl> TRUE ## $ projects.contributors.contactName              <list> <\"Moshi,,Song\", \"Nanze… ## $ projects.contributors.correspondingContributor <list> <TRUE, TRUE, TRUE> ## $ projects.contributors.email                    <list> <\"qujing@ioz.ac.cn\", \"g… ## $ projects.contributors.institution              <list> <\"State Key Laboratory … ## $ projects.contributors.laboratory               <lgl> NA ## $ projects.contributors.projectRole              <chr> \"data curator\" ## $ projects.estimatedCellCount                    <int> 35678 ## $ projects.laboratory                            <lgl> NA ## $ projects.projectDescription                    <chr> \"Skin undergoes constan… ## $ projects.projectId                             <chr> \"923d3231-7295-4184-b3… ## $ projects.projectShortname                      <chr> \"AgingSkinAtlas\" ## $ projects.projectTitle                          <chr> \"A Single-Cell Transcr… ## $ projects.publications.doi                      <chr> \"10.1016/j.devcel.2020… ## $ projects.publications.officialHcaPublication   <lgl> TRUE ## $ projects.publications.publicationTitle         <chr> \"A Single-Cell Transcr… ## $ projects.publications.publicationUrl           <chr> \"https://www.sciencedir… ## $ projects.supplementaryLinks                    <chr> \"https://bigd.big.ac.cn… ## $ protocols.instrumentManufacturerModel          <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach          <chr> \"10x 3' v2\" ## $ protocols.nucleicAcidSource                    <chr> \"single cell\" ## $ protocols.pairedEnd                            <lgl> FALSE ## $ samples.disease                                <chr> \"normal\" ## $ samples.effectiveOrgan                         <chr> \"skin of body\" ## $ samples.id                                     <list> <\"HRS118996\", \"HRS11899… ## $ samples.organ                                  <chr> \"skin of body\" ## $ samples.organPart                              <lgl> NA ## $ samples.preservationMethod                     <lgl> NA ## $ samples.sampleEntityType                       <chr> \"specimens\" ## $ samples.source                                 <chr> \"specimen_from_organism\" ## $ sources.sourceId                               <chr> \"60e92fc4-5ca3-462e-aba… ## $ sources.sourceSpec                             <chr> \"tdr:datarepo-b6764413:… ## $ specimens.disease                              <chr> \"normal\" ## $ specimens.id                                   <list> <\"HRS118996\", \"HRS11899… ## $ specimens.organ                                <chr> \"skin of body\" ## $ specimens.organPart                            <lgl> NA ## $ specimens.preservationMethod                   <lgl> NA ## $ specimens.source                               <chr> \"specimen_from_organism\" ## $ samples.accessible                             <lgl> TRUE"},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"anomalies","dir":"Articles","previous_headings":"","what":"Anomalies","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"count","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-923d3231-7295-4184-b3f6-c3082766a8c7.html","id":"sessioninfo","dir":"Articles","previous_headings":"","what":"sessionInfo()","title":"Case Study: A Single-Cell Transcriptomic Atlas of Human Skin Aging","text":"","code":"sessionInfo() ## R version 4.2.1 Patched (2022-10-03 r83008) ## Platform: aarch64-apple-darwin21.6.0 (64-bit) ## Running under: macOS Monterey 12.6 ##  ## Matrix products: default ## BLAS:   /Users/ma38727/bin/R-4-2-branch/lib/libRblas.dylib ## LAPACK: /Users/ma38727/bin/R-4-2-branch/lib/libRlapack.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] dplyr_1.0.10              hca_1.5.7                 ## [3] hcaCaseStudies_0.0.0.9004 BiocStyle_2.25.0          ##  ## loaded via a namespace (and not attached): ##  [1] Rcpp_1.0.9          lattice_0.20-45     tidyr_1.2.1         ##  [4] assertthat_0.2.1    rprojroot_2.0.3     digest_0.6.29       ##  [7] utf8_1.2.2          mime_0.12           BiocFileCache_2.5.0 ## [10] R6_2.5.1            RSQLite_2.2.18      evaluate_0.16       ## [13] httr_1.4.4          pillar_1.8.1        rlang_1.0.6         ## [16] curl_4.3.2          miniUI_0.1.1.1      whisker_0.4         ## [19] jquerylib_0.1.4     blob_1.2.3          Matrix_1.5-1        ## [22] DT_0.25             rmarkdown_2.16      pkgdown_2.0.6       ## [25] textshaping_0.3.6   desc_1.4.2          readr_2.1.3         ## [28] stringr_1.4.1       htmlwidgets_1.5.4   bit_4.0.4           ## [31] shiny_1.7.2         compiler_4.2.1      httpuv_1.6.6        ## [34] xfun_0.33           pkgconfig_2.0.3     systemfonts_1.0.4   ## [37] htmltools_0.5.3     tidyselect_1.1.2    tibble_3.1.8        ## [40] bookdown_0.29       fansi_1.0.3         tzdb_0.3.0          ## [43] dbplyr_2.2.1        later_1.3.0         rappdirs_0.3.3      ## [46] grid_4.2.1          jsonlite_1.8.2      xtable_1.8-4        ## [49] lifecycle_1.0.2     DBI_1.1.3           magrittr_2.0.3      ## [52] cli_3.4.1           stringi_1.7.8       cachem_1.0.6        ## [55] fs_1.5.2            promises_1.2.0.1    bslib_0.4.0         ## [58] ellipsis_0.3.2      filelock_1.0.2      ragg_1.2.3          ## [61] generics_0.1.3      vctrs_0.4.2         tools_4.2.1         ## [64] bit64_4.0.5         glue_1.6.2          purrr_0.3.5         ## [67] hms_1.1.2           fastmap_1.1.0       yaml_2.3.5          ## [70] BiocManager_1.30.18 memoise_2.0.1       knitr_1.40          ## [73] sass_0.4.2"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"Load useful packages","code":"library(hcaCaseStudies) library(hca) library(dplyr) pivot_wider <- tidyr::pivot_wider"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"project-information","dir":"Articles","previous_headings":"Setup","what":"Project information","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"Set project id Display information project","code":"project_id <- \"9a23ac2d-93dd-4bac-9bb8-040e6426db9d\" project_information(project_id) ## Title ##   Single-cell transcriptomic and proteomic analysis of Parkinson’s ##   disease brains ## Contributors (unknown order; any role) ##   Le Zhang, Rachel Schwartz ## Description ##   Parkinson’s disease (PD) is a prevalent neurodegenerative disorder ##   where recent evidence suggests pathogenesis may be mediated by ##   inflammatory processes. The molecular architecture of the disease ##   remains to be fully elucidated. We performed single-nucleus ##   transcriptomics and unbiased proteomics using postmortem tissue ##   obtained from the prefrontal cortex of 12 individuals with late-stage ##   PD and age-matched controls. We analyzed ~80,000 nuclei and ##   identified eight major cell types, including brain-resident T cells, ##   each with distinct transcriptional changes in line with the known ##   genetics of PD. By analyzing Lewy body pathology in the same ##   postmortem tissue, we found that α-synuclein pathology is inversely ##   correlated with chaperone expression in excitatory neurons. Examining ##   cell-cell interactions, we found a selective abatement of ##   neuron-astrocyte interactions and enhanced neuroinflammation. ##   Proteomic analyses of the same brains identified synaptic proteins in ##   prefrontal cortex that were preferentially downregulated in PD. ##   Strikingly, comparing this dataset to a regionally similar published ##   analysis for Alzheimer’s disease (AD), we found no common ##   differentially expressed genes in neurons, but identified many shared ##   differentially expressed genes in glial cells, suggesting that ##   disease etiology in PD and AD are likely distinct. These data are ##   presented as a resource for interrogating the molecular and cellular ##   basis of PD and other neurodegenerative diseases. ## doi: NA ## url: NA ## project: https://data.humancellatlas.org/explore/projects/9a23ac2d-93dd-4bac-9bb8-040e6426db9d"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"conventions","dir":"Articles","previous_headings":"Setup","what":"Conventions","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"Statistics calculated locally use local.* column names, e.g., local.cellCount.","code":""},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"project-samples","dir":"Articles","previous_headings":"Data processing","what":"Project & samples","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"Create filter identify project Find project Samples associated project Columns either variable therefore describe sample-level information… …invariant reflect experiment-wide annotation (also found project data)","code":"project_filter <- filters(projectId = list(is = project_id)) p <-     projects(project_filter, as = \"tibble_expanded\") |>     ## some column names are very long...     rename_with(         ~ sub(\".*\\\\.(.*)\", \"projects.contributedAnalyses.\\\\1\", .x),         starts_with(\"projects.contributedAnalyses\")     )  p |> glimpse() ## Rows: 1 ## Columns: 76 ## $ projectId                                       <chr> \"9a23ac2d-93dd-4bac-9b… ## $ cellSuspensions.organ                           <chr> \"brain\" ## $ cellSuspensions.organPart                       <chr> \"dorsolateral prefront… ## $ cellSuspensions.selectedCellType                <lgl> NA ## $ cellSuspensions.totalCells                      <lgl> NA ## $ dates.aggregateLastModifiedDate                 <chr> \"2022-08-26T23:02:34.0… ## $ dates.aggregateSubmissionDate                   <chr> \"2022-08-26T19:50:13.3… ## $ dates.aggregateUpdateDate                       <chr> \"2022-08-26T23:02:34.0… ## $ dates.lastModifiedDate                          <chr> \"2022-08-26T21:58:12.5… ## $ dates.submissionDate                            <chr> \"2022-08-26T19:50:13.3… ## $ dates.updateDate                                <chr> \"2022-08-26T21:58:12.5… ## $ donorOrganisms.biologicalSex                    <list> <\"female\", \"male\"> ## $ donorOrganisms.developmentStage                 <chr> \"human adult stage\" ## $ donorOrganisms.disease                          <list> <\"Parkinson disease\", … ## $ donorOrganisms.donorCount                       <int> 12 ## $ donorOrganisms.genusSpecies                     <chr> \"Homo sapiens\" ## $ donorOrganisms.id                               <list> <\"HSDG07HC_HHT\", \"HSDG… ## $ donorOrganisms.organismAge.unit                 <list> <\"year\", \"year\", \"year… ## $ donorOrganisms.organismAge.value                <list> <\"63.0\", \"65.0\", \"69.… ## $ donorOrganisms.organismAgeRange                 <list> <1986768000, 198676800… ## $ fileTypeSummaries.contentDescription            <list> <\"Feature table\", \"Ge… ## $ fileTypeSummaries.count                         <list> <1, 36> ## $ fileTypeSummaries.fileSource                    <chr> \"GEO\" ## $ fileTypeSummaries.format                        <list> <\"tar\", \"fastq.gz\"> ## $ fileTypeSummaries.isIntermediate                <lgl> FALSE ## $ fileTypeSummaries.matrixCellCount               <lgl> NA ## $ fileTypeSummaries.totalSize                     <list> <719482880, 5061288652… ## $ projects.accessible                             <lgl> TRUE ## $ projects.accessions.accession                   <chr> \"GSE202210\" ## $ projects.accessions.namespace                   <chr> \"geo_series\" ## $ projects.contributedAnalyses.contentDescription <list> <\"Feature table\", \"Gen… ## $ projects.contributedAnalyses.drs_uri            <chr> \"drs://data.terra.bio… ## $ projects.contributedAnalyses.fileSource         <chr> \"GEO\" ## $ projects.contributedAnalyses.format             <chr> \"tar\" ## $ projects.contributedAnalyses.isIntermediate     <lgl> FALSE ## $ projects.contributedAnalyses.matrixCellCount    <lgl> NA ## $ projects.contributedAnalyses.name               <chr> \"GSE202210_RAW.tar\" ## $ projects.contributedAnalyses.sha256             <chr> \"6d65eb60c292d5657e1b… ## $ projects.contributedAnalyses.size               <int> 719482880 ## $ projects.contributedAnalyses.url                <chr> \"https://service.azul… ## $ projects.contributedAnalyses.uuid               <chr> \"a56df86f-a78e-4270-9… ## $ projects.contributedAnalyses.version            <chr> \"2022-08-26T21:58:59.… ## $ projects.contributors.contactName               <list> <\"Le,,Zhang\", \"Rachel… ## $ projects.contributors.correspondingContributor  <list> <TRUE, FALSE> ## $ projects.contributors.email                     <list> <\"le.zhang@yale.edu\", … ## $ projects.contributors.institution               <list> <\"Yale University\", \"… ## $ projects.contributors.laboratory                <list> <\"Neurology\", \"Human C… ## $ projects.contributors.projectRole               <list> <\"principal investigat… ## $ projects.estimatedCellCount                     <int> 80000 ## $ projects.laboratory                             <list> <\"Human Cell Atlas Da… ## $ projects.projectDescription                     <chr> \"Parkinson’s disease (… ## $ projects.projectId                              <chr> \"9a23ac2d-93dd-4bac-9b… ## $ projects.projectShortname                       <chr> \"ZhangLabPdBrainNuclei\" ## $ projects.projectTitle                           <chr> \"Single-cell transcrip… ## $ projects.supplementaryLinks                     <lgl> NA ## $ protocols.instrumentManufacturerModel           <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach           <chr> \"10x 3' v3\" ## $ protocols.nucleicAcidSource                     <chr> \"single nucleus\" ## $ protocols.pairedEnd                             <lgl> FALSE ## $ protocols.workflow                              <chr> \"analysis_protocol_1\" ## $ samples.disease                                 <list> <\"Parkinson disease\",… ## $ samples.effectiveOrgan                          <chr> \"brain\" ## $ samples.id                                      <list> <\"GSM6106340\", \"GSM610… ## $ samples.organ                                   <chr> \"brain\" ## $ samples.organPart                               <chr> \"dorsolateral prefront… ## $ samples.preservationMethod                      <lgl> NA ## $ samples.sampleEntityType                        <chr> \"specimens\" ## $ samples.source                                  <chr> \"specimen_from_organis… ## $ sources.sourceId                                <chr> \"aa623d49-c868-4a3a-83… ## $ sources.sourceSpec                              <chr> \"tdr:datarepo-c341e9ae… ## $ specimens.disease                               <list> <\"Parkinson disease\", … ## $ specimens.id                                    <list> <\"GSM6106340\", \"GSM610… ## $ specimens.organ                                 <chr> \"brain\" ## $ specimens.organPart                             <chr> \"dorsolateral prefront… ## $ specimens.preservationMethod                    <lgl> NA ## $ specimens.source                                <chr> \"specimen_from_organis… s <- samples(project_filter, as = \"tibble_expanded\") ## informative 'specimen' or 'donorOrganisms' columns s |>     select(starts_with(\"specimens\") | starts_with(\"donorOrganisms\")) |>     select(where(column_is_informative)) ## # A tibble: 12 × 7 ##    specimens.disease specimens.id donorOrganis…¹ donor…² donor…³ donor…⁴ donor…⁵ ##    <chr>             <chr>        <chr>          <chr>   <chr>   <chr>   <list>  ##  1 normal            GSM6106343   female         normal  hsDG13… 65.0    <dbl>   ##  2 Parkinson disease GSM6106348   male           Parkin… HSDG19… 86.0    <dbl>   ##  3 normal            GSM6106340   female         normal  HSDG07… 81.0    <dbl>   ##  4 Parkinson disease GSM6106347   female         Parkin… hsDG19… 72.0    <dbl>   ##  5 normal            GSM6106350   male           normal  hsDG30… 63.0    <dbl>   ##  6 Parkinson disease GSM6106346   female         Parkin… hsDG15… 81.0    <dbl>   ##  7 normal            GSM6106351   male           normal  hsDG99… 69.0    <dbl>   ##  8 Parkinson disease GSM6106349   female         Parkin… hsDG20… 77.0    <dbl>   ##  9 normal            GSM6106342   male           normal  HSDG10… 70.0    <dbl>   ## 10 Parkinson disease GSM6106345   male           Parkin… HSDG14… 96.0    <dbl>   ## 11 normal            GSM6106341   female         normal  hsDG10… 72.0    <dbl>   ## 12 Parkinson disease GSM6106344   male           Parkin… hsDG14… 79.0    <dbl>   ## # … with abbreviated variable names ¹​donorOrganisms.biologicalSex, ## #   ²​donorOrganisms.disease, ³​donorOrganisms.id, ## #   ⁴​donorOrganisms.organismAge.value, ⁵​donorOrganisms.organismAgeRange  s |>     count(specimens.disease, donorOrganisms.biologicalSex) |>     pivot_wider(         names_from = \"donorOrganisms.biologicalSex\",         values_from = \"n\"     ) ## # A tibble: 2 × 3 ##   specimens.disease female  male ##   <chr>              <int> <int> ## 1 normal                 3     3 ## 2 Parkinson disease      3     3 s |>     select(where(column_is_experimentwide)) |>     distinct() |>     glimpse() ## Rows: 1 ## Columns: 32 ## $ cellSuspensions.organ                 <chr> \"brain\" ## $ cellSuspensions.organPart             <chr> \"dorsolateral prefrontal cortex\" ## $ donorOrganisms.developmentStage       <chr> \"human adult stage\" ## $ donorOrganisms.donorCount             <int> 1 ## $ donorOrganisms.genusSpecies           <chr> \"Homo sapiens\" ## $ donorOrganisms.organismAge.unit       <chr> \"year\" ## $ fileTypeSummaries.contentDescription  <list> <\"Feature table\", \"Gene expressi… ## $ fileTypeSummaries.count               <list> <1, 3> ## $ fileTypeSummaries.fileSource          <chr> \"GEO\" ## $ fileTypeSummaries.format              <list> <\"tar\", \"fastq.gz\"> ## $ fileTypeSummaries.isIntermediate      <lgl> FALSE ## $ projects.estimatedCellCount           <int> 80000 ## $ projects.laboratory                   <list> <\"Human Cell Atlas Data Coordina… ## $ projects.projectId                    <chr> \"9a23ac2d-93dd-4bac-9bb8-040e642… ## $ projects.projectShortname             <chr> \"ZhangLabPdBrainNuclei\" ## $ projects.projectTitle                 <chr> \"Single-cell transcriptomic and … ## $ protocols.instrumentManufacturerModel <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach <chr> \"10x 3' v3\" ## $ protocols.nucleicAcidSource           <chr> \"single nucleus\" ## $ protocols.pairedEnd                   <lgl> FALSE ## $ protocols.workflow                    <chr> \"analysis_protocol_1\" ## $ samples.accessible                    <lgl> TRUE ## $ samples.effectiveOrgan                <chr> \"brain\" ## $ samples.organ                         <chr> \"brain\" ## $ samples.organPart                     <chr> \"dorsolateral prefrontal cortex\" ## $ samples.sampleEntityType              <chr> \"specimens\" ## $ samples.source                        <chr> \"specimen_from_organism\" ## $ sources.sourceId                      <chr> \"aa623d49-c868-4a3a-8365-bf895f0… ## $ sources.sourceSpec                    <chr> \"tdr:datarepo-c341e9ae:snapshot/… ## $ specimens.organ                       <chr> \"brain\" ## $ specimens.organPart                   <chr> \"dorsolateral prefrontal cortex\" ## $ specimens.source                      <chr> \"specimen_from_organism\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"data-files","dir":"Articles","previous_headings":"Data processing","what":"Data files","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"types files project ? Looks like ‘tar’ file contains useful data Retrieve cache locally files needed construct gene x cell count matrix. ‘tar’ archive GSM files; untar temporary location Parse file names create tibble local file path, file type, sample id Extract data files, e.g., cell gene counts.","code":"files1 <- files(project_filter)  files1 |>     glimpse() ## Rows: 37 ## Columns: 8 ## $ fileId       <chr> \"47c37cc9-72ea-473e-a2fc-2e92c3263069\", \"eaf79c9e-1d18-47… ## $ name         <chr> \"SRR19085688_I1.fastq.gz\", \"SRR19085694_R1.fastq.gz\", \"SR… ## $ fileFormat   <chr> \"fastq.gz\", \"fastq.gz\", \"fastq.gz\", \"fastq.gz\", \"fastq.gz… ## $ size         <dbl> 5545686966, 12335195016, 5789934692, 10301311199, 2458048… ## $ version      <chr> \"2022-08-26T21:58:23.041000Z\", \"2022-08-26T21:58:23.40100… ## $ projectTitle <chr> \"Single-cell transcriptomic and proteomic analysis of Par… ## $ projectId    <chr> \"9a23ac2d-93dd-4bac-9bb8-040e6426db9d\", \"9a23ac2d-93dd-4b… ## $ url          <chr> \"https://service.azul.data.humancellatlas.org/repository/…  files1 |>     count(fileFormat) ## # A tibble: 2 × 2 ##   fileFormat     n ##   <chr>      <int> ## 1 fastq.gz      36 ## 2 tar            1 files2 <-     files1 |>     filter(fileFormat == \"tar\") tar_file <-     files2 |>     files_download() |>     setNames(files2 |> pull(name)) ## what files are in the tar? tar_files <- untar(tar_file, list = TRUE) length(tar_files) ## [1] 36 head(tar_files) ## [1] \"GSM6106340_HSDG07HC_barcodes.tsv.gz\"  ## [2] \"GSM6106340_HSDG07HC_genes.tsv.gz\"     ## [3] \"GSM6106340_HSDG07HC_matrix.mtx.gz\"    ## [4] \"GSM6106341_hsDG101HC_barcodes.tsv.gz\" ## [5] \"GSM6106341_hsDG101HC_genes.tsv.gz\"    ## [6] \"GSM6106341_hsDG101HC_matrix.mtx.gz\"  ## untar to a temporary location exdir <- tempfile(); dir.create(exdir) untar(tar_file, exdir = exdir) local_files <-     tibble(         local.filePath = file.path(exdir, tar_files),         ## local.fileType becomes one of barcodesPath, genesPath, matrixPath         local.fileType = sub(\".*_([[:alpha:]]*).*\", \"\\\\1Path\", tar_files),         local.sampleId = sub(\"([^_]*).*\", \"\\\\1\", tar_files)     ) |>     ## each 'sampleId' has a barcodesPath, genesPath, and matrixPath     pivot_wider(         names_from = local.fileType,         names_prefix = \"local.\",         values_from = \"local.filePath\"     )  ## 12 samples local_files |>     mutate(across(ends_with(\"Path\"), basename)) ## # A tibble: 12 × 4 ##    local.sampleId local.barcodesPath                   local.genesPath   local…¹ ##    <chr>          <chr>                                <chr>             <chr>   ##  1 GSM6106340     GSM6106340_HSDG07HC_barcodes.tsv.gz  GSM6106340_HSDG0… GSM610… ##  2 GSM6106341     GSM6106341_hsDG101HC_barcodes.tsv.gz GSM6106341_hsDG1… GSM610… ##  3 GSM6106342     GSM6106342_HSDG10HC_barcodes.tsv.gz  GSM6106342_HSDG1… GSM610… ##  4 GSM6106343     GSM6106343_hsDG13HC_barcodes.tsv.gz  GSM6106343_hsDG1… GSM610… ##  5 GSM6106344     GSM6106344_hsDG142PD_barcodes.tsv.gz GSM6106344_hsDG1… GSM610… ##  6 GSM6106345     GSM6106345_HSDG148PD_barcodes.tsv.gz GSM6106345_HSDG1… GSM610… ##  7 GSM6106346     GSM6106346_hsDG151PD_barcodes.tsv.gz GSM6106346_hsDG1… GSM610… ##  8 GSM6106347     GSM6106347_hsDG197PD_barcodes.tsv.gz GSM6106347_hsDG1… GSM610… ##  9 GSM6106348     GSM6106348_HSDG199PD_barcodes.tsv.gz GSM6106348_HSDG1… GSM610… ## 10 GSM6106349     GSM6106349_hsDG208PD_barcodes.tsv.gz GSM6106349_hsDG2… GSM610… ## 11 GSM6106350     GSM6106350_hsDG30HC_barcodes.tsv.gz  GSM6106350_hsDG3… GSM610… ## 12 GSM6106351     GSM6106351_hsDG99HC_barcodes.tsv.gz  GSM6106351_hsDG9… GSM610… ## # … with abbreviated variable name ¹​local.matrixPath gene_and_cell_counts <-     local_files |>     csv_tsv_gz_count_lines(\"local.sampleId\", \"local.barcodesPath\") |>     rename(local.cellCount = local.lines) |>     csv_tsv_gz_count_lines(\"local.sampleId\", \"local.genesPath\") |>     rename(local.geneCount = local.lines)  gene_and_cell_counts |>     select(local.sampleId, local.geneCount, local.cellCount) ## # A tibble: 12 × 3 ##    local.sampleId local.geneCount local.cellCount ##    <chr>                    <int>           <int> ##  1 GSM6106340               33538            4813 ##  2 GSM6106341               33538            5863 ##  3 GSM6106342               33538            7455 ##  4 GSM6106343               33538            5092 ##  5 GSM6106344               33538            8316 ##  6 GSM6106345               33538            9071 ##  7 GSM6106346               33538            1891 ##  8 GSM6106347               33538           10440 ##  9 GSM6106348               33538            7365 ## 10 GSM6106349               33538            5633 ## 11 GSM6106350               33538            6246 ## 12 GSM6106351               33538            5798"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"count-matrix","dir":"Articles","previous_headings":"Data processing","what":"Count matrix","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"sample ‘matrix mart’ text file representing counts cells sample. Use mtx_count_matrix() read dgCMatrix sparse matrix (defined Matrix package). Save package cache re-use across R sessions.","code":"object_name <- \"local.countMatrix\" if (!cache_exists(project_id, object_name)) {     local_files |>         mtx_count_matrix(             \"local.matrixPath\", \"local.genesPath\", \"local.barcodesPath\"         ) |>         cache_add(project_id, object_name) } count_matrix <- cache_read(project_id, object_name)  class(count_matrix)[1] # sparse matrix ## [1] \"dgCMatrix\" format(object.size(count_matrix), units = \"auto\") # how much memory? ## [1] \"2.6 Gb\"  ## dimensions of genes x cells count matrix should match annotation summaries dim(count_matrix)      # genes x cells ## [1] 33538 77983 gene_and_cell_counts |>     summarize(genes = unique(local.geneCount), cells = sum(local.cellCount)) ## # A tibble: 1 × 2 ##   genes cells ##   <int> <int> ## 1 33538 77983"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"row-sample-and-cell-annotations","dir":"Articles","previous_headings":"Data processing","what":"Row, sample, and cell annotations","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"Row (gene) data Column (sample & cell) data","code":"## all 'genes' files are identical? row_data <-     local_files |>     slice(1) |>     pull(\"local.genesPath\") |>     readr::read_tsv(         col_names = c(\"ensembl_id\", \"hugo_symbol\", \"annotation\"),         show_col_types = FALSE         )  row_data ## # A tibble: 33,538 × 3 ##    ensembl_id      hugo_symbol annotation      ##    <chr>           <chr>       <chr>           ##  1 ENSG00000243485 MIR1302-2HG Gene Expression ##  2 ENSG00000237613 FAM138A     Gene Expression ##  3 ENSG00000186092 OR4F5       Gene Expression ##  4 ENSG00000238009 AL627309.1  Gene Expression ##  5 ENSG00000239945 AL627309.3  Gene Expression ##  6 ENSG00000239906 AL627309.2  Gene Expression ##  7 ENSG00000241599 AL627309.4  Gene Expression ##  8 ENSG00000236601 AL732372.1  Gene Expression ##  9 ENSG00000284733 OR4F29      Gene Expression ## 10 ENSG00000235146 AC114498.1  Gene Expression ## # … with 33,528 more rows sample_data <-     ## from the hca sample annotation...     s |>     select(         where(column_is_informative) & where(is.atomic)     ) |>     ## ...and local_files (gene and cell counts)     left_join(         gene_and_cell_counts |>         select(local.sampleId, local.cellCount, local.geneCount),         by = c(samples.id = \"local.sampleId\")     )  sample_data |> DT::datatable() cell_barcodes <-     local_files |>     pull(\"local.barcodesPath\") |>     lapply(readLines)  sampleId <- pull(local_files, \"local.sampleId\") cell_data <- tibble(     local.sampleId = rep(sampleId, lengths(cell_barcodes)),     local.barcodes = unlist(cell_barcodes, use.names = FALSE) )  cell_data ## # A tibble: 77,983 × 2 ##    local.sampleId local.barcodes     ##    <chr>          <chr>              ##  1 GSM6106340     AAACCCAAGAATAACC-1 ##  2 GSM6106340     AAACCCAAGTCATCCA-1 ##  3 GSM6106340     AAACCCAGTAATCAGA-1 ##  4 GSM6106340     AAACCCATCCATTCGC-1 ##  5 GSM6106340     AAACGAAAGGAGTACC-1 ##  6 GSM6106340     AAACGAACATGAAGCG-1 ##  7 GSM6106340     AAACGAAGTGCCTACG-1 ##  8 GSM6106340     AAACGAAGTGTTCATG-1 ##  9 GSM6106340     AAACGAAGTTGCCAAT-1 ## 10 GSM6106340     AAACGAAGTTGCTGAT-1 ## # … with 77,973 more rows  ## N.B. some barcodes are duplicated 2 or 3 times cell_data |>     count(local.barcodes, sort = TRUE, name = \"occurrences\") |>     count(occurrences, name = \"n_barcodes\") ## # A tibble: 3 × 2 ##   occurrences n_barcodes ##         <int>      <int> ## 1           1      76272 ## 2           2        830 ## 3           3         17"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"experiment-wide-metadata","dir":"Articles","previous_headings":"Data processing","what":"Experiment-wide metadata","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"","code":"sample_metadata <-     s |>     select(where(column_is_experimentwide) & !any_of(names(p))) |>     distinct()  metadata <- bind_cols(p, sample_metadata)  metadata |>     glimpse() ## Rows: 1 ## Columns: 77 ## $ projectId                                       <chr> \"9a23ac2d-93dd-4bac-9b… ## $ cellSuspensions.organ                           <chr> \"brain\" ## $ cellSuspensions.organPart                       <chr> \"dorsolateral prefront… ## $ cellSuspensions.selectedCellType                <lgl> NA ## $ cellSuspensions.totalCells                      <lgl> NA ## $ dates.aggregateLastModifiedDate                 <chr> \"2022-08-26T23:02:34.0… ## $ dates.aggregateSubmissionDate                   <chr> \"2022-08-26T19:50:13.3… ## $ dates.aggregateUpdateDate                       <chr> \"2022-08-26T23:02:34.0… ## $ dates.lastModifiedDate                          <chr> \"2022-08-26T21:58:12.5… ## $ dates.submissionDate                            <chr> \"2022-08-26T19:50:13.3… ## $ dates.updateDate                                <chr> \"2022-08-26T21:58:12.5… ## $ donorOrganisms.biologicalSex                    <list> <\"female\", \"male\"> ## $ donorOrganisms.developmentStage                 <chr> \"human adult stage\" ## $ donorOrganisms.disease                          <list> <\"Parkinson disease\", … ## $ donorOrganisms.donorCount                       <int> 12 ## $ donorOrganisms.genusSpecies                     <chr> \"Homo sapiens\" ## $ donorOrganisms.id                               <list> <\"HSDG07HC_HHT\", \"HSDG… ## $ donorOrganisms.organismAge.unit                 <list> <\"year\", \"year\", \"year… ## $ donorOrganisms.organismAge.value                <list> <\"63.0\", \"65.0\", \"69.… ## $ donorOrganisms.organismAgeRange                 <list> <1986768000, 198676800… ## $ fileTypeSummaries.contentDescription            <list> <\"Feature table\", \"Ge… ## $ fileTypeSummaries.count                         <list> <1, 36> ## $ fileTypeSummaries.fileSource                    <chr> \"GEO\" ## $ fileTypeSummaries.format                        <list> <\"tar\", \"fastq.gz\"> ## $ fileTypeSummaries.isIntermediate                <lgl> FALSE ## $ fileTypeSummaries.matrixCellCount               <lgl> NA ## $ fileTypeSummaries.totalSize                     <list> <719482880, 5061288652… ## $ projects.accessible                             <lgl> TRUE ## $ projects.accessions.accession                   <chr> \"GSE202210\" ## $ projects.accessions.namespace                   <chr> \"geo_series\" ## $ projects.contributedAnalyses.contentDescription <list> <\"Feature table\", \"Gen… ## $ projects.contributedAnalyses.drs_uri            <chr> \"drs://data.terra.bio… ## $ projects.contributedAnalyses.fileSource         <chr> \"GEO\" ## $ projects.contributedAnalyses.format             <chr> \"tar\" ## $ projects.contributedAnalyses.isIntermediate     <lgl> FALSE ## $ projects.contributedAnalyses.matrixCellCount    <lgl> NA ## $ projects.contributedAnalyses.name               <chr> \"GSE202210_RAW.tar\" ## $ projects.contributedAnalyses.sha256             <chr> \"6d65eb60c292d5657e1b… ## $ projects.contributedAnalyses.size               <int> 719482880 ## $ projects.contributedAnalyses.url                <chr> \"https://service.azul… ## $ projects.contributedAnalyses.uuid               <chr> \"a56df86f-a78e-4270-9… ## $ projects.contributedAnalyses.version            <chr> \"2022-08-26T21:58:59.… ## $ projects.contributors.contactName               <list> <\"Le,,Zhang\", \"Rachel… ## $ projects.contributors.correspondingContributor  <list> <TRUE, FALSE> ## $ projects.contributors.email                     <list> <\"le.zhang@yale.edu\", … ## $ projects.contributors.institution               <list> <\"Yale University\", \"… ## $ projects.contributors.laboratory                <list> <\"Neurology\", \"Human C… ## $ projects.contributors.projectRole               <list> <\"principal investigat… ## $ projects.estimatedCellCount                     <int> 80000 ## $ projects.laboratory                             <list> <\"Human Cell Atlas Da… ## $ projects.projectDescription                     <chr> \"Parkinson’s disease (… ## $ projects.projectId                              <chr> \"9a23ac2d-93dd-4bac-9b… ## $ projects.projectShortname                       <chr> \"ZhangLabPdBrainNuclei\" ## $ projects.projectTitle                           <chr> \"Single-cell transcrip… ## $ projects.supplementaryLinks                     <lgl> NA ## $ protocols.instrumentManufacturerModel           <chr> \"Illumina NovaSeq 6000\" ## $ protocols.libraryConstructionApproach           <chr> \"10x 3' v3\" ## $ protocols.nucleicAcidSource                     <chr> \"single nucleus\" ## $ protocols.pairedEnd                             <lgl> FALSE ## $ protocols.workflow                              <chr> \"analysis_protocol_1\" ## $ samples.disease                                 <list> <\"Parkinson disease\",… ## $ samples.effectiveOrgan                          <chr> \"brain\" ## $ samples.id                                      <list> <\"GSM6106340\", \"GSM610… ## $ samples.organ                                   <chr> \"brain\" ## $ samples.organPart                               <chr> \"dorsolateral prefront… ## $ samples.preservationMethod                      <lgl> NA ## $ samples.sampleEntityType                        <chr> \"specimens\" ## $ samples.source                                  <chr> \"specimen_from_organis… ## $ sources.sourceId                                <chr> \"aa623d49-c868-4a3a-83… ## $ sources.sourceSpec                              <chr> \"tdr:datarepo-c341e9ae… ## $ specimens.disease                               <list> <\"Parkinson disease\", … ## $ specimens.id                                    <list> <\"GSM6106340\", \"GSM610… ## $ specimens.organ                                 <chr> \"brain\" ## $ specimens.organPart                             <chr> \"dorsolateral prefront… ## $ specimens.preservationMethod                    <lgl> NA ## $ specimens.source                                <chr> \"specimen_from_organis… ## $ samples.accessible                              <lgl> TRUE"},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"anomalies","dir":"Articles","previous_headings":"","what":"Anomalies","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"None noted.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9a23ac2d-93dd-4bac-9bb8-040e6426db9d.html","id":"sessioninfo","dir":"Articles","previous_headings":"","what":"sessionInfo()","title":"Case Study: Single-cell transcriptomic and proteomic analysis of Parkinson’s disease brains","text":"","code":"sessionInfo() ## R version 4.2.1 Patched (2022-10-03 r83008) ## Platform: aarch64-apple-darwin21.6.0 (64-bit) ## Running under: macOS Monterey 12.6 ##  ## Matrix products: default ## BLAS:   /Users/ma38727/bin/R-4-2-branch/lib/libRblas.dylib ## LAPACK: /Users/ma38727/bin/R-4-2-branch/lib/libRlapack.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] dplyr_1.0.10              hca_1.5.7                 ## [3] hcaCaseStudies_0.0.0.9004 BiocStyle_2.25.0          ##  ## loaded via a namespace (and not attached): ##  [1] Rcpp_1.0.9          lattice_0.20-45     tidyr_1.2.1         ##  [4] assertthat_0.2.1    rprojroot_2.0.3     digest_0.6.29       ##  [7] utf8_1.2.2          mime_0.12           BiocFileCache_2.5.0 ## [10] R6_2.5.1            RSQLite_2.2.18      evaluate_0.16       ## [13] httr_1.4.4          pillar_1.8.1        rlang_1.0.6         ## [16] curl_4.3.2          miniUI_0.1.1.1      whisker_0.4         ## [19] jquerylib_0.1.4     blob_1.2.3          Matrix_1.5-1        ## [22] DT_0.25             rmarkdown_2.16      pkgdown_2.0.6       ## [25] textshaping_0.3.6   desc_1.4.2          readr_2.1.3         ## [28] stringr_1.4.1       htmlwidgets_1.5.4   bit_4.0.4           ## [31] shiny_1.7.2         compiler_4.2.1      httpuv_1.6.6        ## [34] xfun_0.33           pkgconfig_2.0.3     systemfonts_1.0.4   ## [37] htmltools_0.5.3     tidyselect_1.1.2    tibble_3.1.8        ## [40] bookdown_0.29       fansi_1.0.3         crayon_1.5.2        ## [43] tzdb_0.3.0          dbplyr_2.2.1        later_1.3.0         ## [46] rappdirs_0.3.3      grid_4.2.1          jsonlite_1.8.2      ## [49] xtable_1.8-4        lifecycle_1.0.2     DBI_1.1.3           ## [52] magrittr_2.0.3      vroom_1.6.0         cli_3.4.1           ## [55] stringi_1.7.8       cachem_1.0.6        fs_1.5.2            ## [58] promises_1.2.0.1    bslib_0.4.0         ellipsis_0.3.2      ## [61] filelock_1.0.2      ragg_1.2.3          generics_0.1.3      ## [64] vctrs_0.4.2         tools_4.2.1         bit64_4.0.5         ## [67] glue_1.6.2          purrr_0.3.5         crosstalk_1.2.0     ## [70] hms_1.1.2           parallel_4.2.1      fastmap_1.1.0       ## [73] yaml_2.3.5          BiocManager_1.30.18 memoise_2.0.1       ## [76] knitr_1.40          sass_0.4.2"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9fc0064b-84ce-40a5-a768-e6eb3d364ee0.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Case Study: Single-cell RNA-seq reveals cell type-specific molecular and genetic associations to lupus","text":"Load useful packages","code":"library(hcaCaseStudies) library(hca) library(dplyr)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9fc0064b-84ce-40a5-a768-e6eb3d364ee0.html","id":"project-information","dir":"Articles","previous_headings":"Setup","what":"Project information","title":"Case Study: Single-cell RNA-seq reveals cell type-specific molecular and genetic associations to lupus","text":"Set project id Display information project","code":"project_id <- \"9fc0064b-84ce-40a5-a768-e6eb3d364ee0\" project_information(project_id) ## Title ##   Single-cell RNA-seq reveals cell type-specific molecular and genetic ##   associations to lupus ## Contributors (unknown order; any role) ##   Andrew Lu, Raymund Bueno, Yang Sun, Serena Kwek, Lindsey Criswell, ##   Julia Waldman, Anton Ogorodnikov, Sasha Targ, Michal Slyper, Noah ##   Zaitlen, Meena Subramaniam, Orit Rozenblatt-Rosen, Jinoos Yazdany, M. ##   Grace Gordon, Richard Perez, Tony Li, Chun Jimmie Ye, Maria Dall’era, ##   Brunilda Balliu, Lenka Maliskova, Mehrdad Matloubian, Mike Thompson, ##   Min Cheol Kim, Aviv Regev, George Hartoularos, Danielle Dionne, Nadav ##   Rappoport, Cristina Lanata, Andrew Dahl, Lawrence Fong ## Description ##   Systemic lupus erythematosus (SLE) is a heterogeneous autoimmune ##   disease. Knowledge of circulating immune cell types and states ##   associated with SLE remains incomplete. We profiled more than 1.2 ##   million peripheral blood mononuclear cells (162 cases, 99 controls) ##   with multiplexed single-cell RNA sequencing (mux-seq). Cases ##   exhibited elevated expression of type 1 interferon-stimulated genes ##   (ISGs) in monocytes, reduction of naïve CD4+ T cells that correlated ##   with monocyte ISG expression, and expansion of repertoire-restricted ##   cytotoxic GZMH+ CD8+ T cells. Cell type-specific expression features ##   predicted case-control status and stratified patients into two ##   molecular subtypes. We integrated dense genotyping data to map cell ##   type-specific cis-expression quantitative trait loci and to link ##   SLE-associated variants to cell type-specific expression. These ##   results demonstrate mux-seq as a systematic approach to characterize ##   cellular composition, identify transcriptional signatures, and ##   annotate genetic variants associated with SLE. ## doi: 10.1126/science.abf1970 ## url: NA ## project: https://data.humancellatlas.org/explore/projects/9fc0064b-84ce-40a5-a768-e6eb3d364ee0"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9fc0064b-84ce-40a5-a768-e6eb3d364ee0.html","id":"conventions","dir":"Articles","previous_headings":"Setup","what":"Conventions","title":"Case Study: Single-cell RNA-seq reveals cell type-specific molecular and genetic associations to lupus","text":"Statistics calculated locally use local.* column names, e.g., local.cellCount.","code":""},{"path":[]},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9fc0064b-84ce-40a5-a768-e6eb3d364ee0.html","id":"project-samples","dir":"Articles","previous_headings":"Data processing","what":"Project & samples","title":"Case Study: Single-cell RNA-seq reveals cell type-specific molecular and genetic associations to lupus","text":"Create filter identify project Find project Samples associated project Columns either variable therefore describe sample-level information… …invariant reflect experiment-wide annotation","code":"project_filter <- filters(projectId = list(is = project_id)) p <- projects(project_filter) p |> glimpse() ## Rows: 1 ## Columns: 13 ## $ projectId                   <chr> \"9fc0064b-84ce-40a5-a768-e6eb3d364ee0\" ## $ projectTitle                <chr> \"Single-cell RNA-seq reveals cell type-spe… ## $ genusSpecies                <chr> \"Homo sapiens\" ## $ sampleEntityType            <chr> \"specimens\" ## $ specimenOrgan               <chr> \"blood\" ## $ specimenOrganPart           <chr> \"blood\" ## $ selectedCellType            <chr> \"peripheral blood mononuclear cell\" ## $ libraryConstructionApproach <chr> \"10x 3' v2\" ## $ nucleicAcidSource           <chr> \"single cell\" ## $ pairedEnd                   <lgl> FALSE ## $ specimenDisease             <chr> \"systemic lupus erythematosus\" ## $ donorDisease                <chr> \"systemic lupus erythematosus\" ## $ developmentStage            <list> <\"20-year-old human stage\", \"21-year-old h… s <- samples(project_filter, as = \"tibble_expanded\") ## informative 'specimen' or 'donorOrganisms' columns s |>     select(starts_with(\"specimens\") | starts_with(\"donorOrganisms\")) |>     select(where(column_is_informative)) |>     glimpse() ## Rows: 274 ## Columns: 9 ## $ specimens.disease                <chr> \"systemic lupus erythematosus\", NA, \"… ## $ specimens.id                     <chr> \"00d8685c-548c-4e5f-b151-47d678b31cd6… ## $ donorOrganisms.biologicalSex     <chr> \"female\", \"female\", \"female\", \"female… ## $ donorOrganisms.developmentStage  <chr> \"55-year-old human stage\", \"24-year-o… ## $ donorOrganisms.disease           <chr> \"systemic lupus erythematosus\", NA, \"… ## $ donorOrganisms.id                <chr> \"ed09f235-5ebf-413d-8199-999fb085fd7f… ## $ donorOrganisms.organismAge.unit  <chr> \"year\", \"year\", \"year\", \"year\", \"year… ## $ donorOrganisms.organismAge.value <chr> \"55\", \"24\", \"56\", \"28\", \"27\", \"41\", \"… ## $ donorOrganisms.organismAgeRange  <list> <1734480000, 1734480000>, <756864000…  ## helper function to group 'donorOrganisms.developmentStage' into deciles stage_to_age <-     function(developmentStage) {     age <- sub(\"-year-old human stage\", \"\", developmentStage)     ## some 'age' are 'variable'; the following adds 'variable' as a level     unknown_age <- grepl(\"variable\", age)     age[unknown_age] <- NA     decade <- addNA(cut(as.integer(age), seq(0, 100, 10)))     levels(decade)[is.na(levels(decade))] <-         unique(developmentStage[unknown_age])     decade }          ## summary of developmentStage (age_decade) and biologicalSex (female, male) s |>     count(donorOrganisms.biologicalSex, donorOrganisms.developmentStage) |>     ## developmentStage format is '20-year-old human stage'; summarize     ## to decade     mutate(         age_decade = stage_to_age(donorOrganisms.developmentStage)     ) |>     group_by(age_decade, donorOrganisms.biologicalSex) |>     summarize(n = sum(n), .groups = \"drop\") |>     tidyr::pivot_wider(                names_from = \"donorOrganisms.biologicalSex\",                values_from = \"n\"            ) ## # A tibble: 9 × 3 ##   age_decade female  male ##   <fct>       <int> <int> ## 1 (10,20]         1    NA ## 2 (20,30]        74     4 ## 3 (30,40]        76     3 ## 4 (40,50]        30     6 ## 5 (50,60]        40     2 ## 6 (60,70]        23     1 ## 7 (70,80]         8    NA ## 8 (80,90]        NA     1 ## 9 variable        5    NA s |>     select(where(column_is_experimentwide)) |>     distinct() |>     glimpse() ## Rows: 1 ## Columns: 25 ## $ cellSuspensions.organ                 <chr> \"blood\" ## $ cellSuspensions.organPart             <chr> \"blood\" ## $ cellSuspensions.selectedCellType      <chr> \"peripheral blood mononuclear ce… ## $ dates.lastModifiedDate                <chr> \"2022-06-22T13:58:50.880576Z\" ## $ dates.submissionDate                  <chr> \"2022-06-22T13:58:50.880576Z\" ## $ donorOrganisms.donorCount             <int> 1 ## $ donorOrganisms.genusSpecies           <chr> \"Homo sapiens\" ## $ fileTypeSummaries.format              <chr> \"fastq\" ## $ projects.projectId                    <chr> \"9fc0064b-84ce-40a5-a768-e6eb3d3… ## $ projects.projectShortname             <chr> \"Single-cellRNA-seqrevealscellty… ## $ projects.projectTitle                 <chr> \"Single-cell RNA-seq reveals cel… ## $ protocols.libraryConstructionApproach <chr> \"10x 3' v2\" ## $ protocols.nucleicAcidSource           <chr> \"single cell\" ## $ protocols.pairedEnd                   <lgl> FALSE ## $ samples.accessible                    <lgl> TRUE ## $ samples.effectiveOrgan                <chr> \"blood\" ## $ samples.organ                         <chr> \"blood\" ## $ samples.organPart                     <chr> \"blood\" ## $ samples.sampleEntityType              <chr> \"specimens\" ## $ samples.source                        <chr> \"specimen_from_organism\" ## $ sources.sourceId                      <chr> \"ac081800-ca0f-44ee-ab97-bf7afc3… ## $ sources.sourceSpec                    <chr> \"tdr:datarepo-935adc8a:snapshot/… ## $ specimens.organ                       <chr> \"blood\" ## $ specimens.organPart                   <chr> \"blood\" ## $ specimens.source                      <chr> \"specimen_from_organism\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9fc0064b-84ce-40a5-a768-e6eb3d364ee0.html","id":"data-files","dir":"Articles","previous_headings":"Data processing","what":"Data files","title":"Case Study: Single-cell RNA-seq reveals cell type-specific molecular and genetic associations to lupus","text":"types files project ? project lot ‘fastq’ files, derived files used easily construct count matrix.","code":"files1 <- files(project_filter)  files1 ## # A tibble: 800 × 8 ##    fileId                    name  fileF…¹    size version proje…² proje…³ url   ##    <chr>                     <chr> <chr>     <dbl> <chr>   <chr>   <chr>   <chr> ##  1 002c870e-da93-43bf-8d9f-… YS-J… fastq   4.78e10 2022-0… Single… 9fc006… http… ##  2 00623cac-3e1e-4d3a-bbc8-… YS-J… fastq   4.58e10 2022-0… Single… 9fc006… http… ##  3 008d4332-c293-4fff-ad0f-… YS-J… fastq   5.07e10 2022-0… Single… 9fc006… http… ##  4 00a7b47a-89ea-4bbe-9501-… YS-J… fastq   6.43e 9 2022-0… Single… 9fc006… http… ##  5 00bb0525-a7bb-472a-ae3f-… immv… fastq   1.58e10 2022-0… Single… 9fc006… http… ##  6 00c2d587-dfa4-4a89-9b5e-… YS-J… fastq   2.76e 9 2022-0… Single… 9fc006… http… ##  7 01adce11-5d8b-42e3-b930-… CLUE… fastq   2.02e 8 2022-0… Single… 9fc006… http… ##  8 01e09367-615c-4f8f-a0d9-… CLUE… fastq   6.12e 8 2022-0… Single… 9fc006… http… ##  9 0240b842-e0fc-4a11-990b-… YE_7… fastq   1.23e10 2022-0… Single… 9fc006… http… ## 10 02543105-abbb-4f5e-b32c-… CLUE… fastq   2.13e 9 2022-0… Single… 9fc006… http… ## # … with 790 more rows, and abbreviated variable names ¹​fileFormat, ## #   ²​projectTitle, ³​projectId  files1 |>     count(fileFormat) ## # A tibble: 1 × 2 ##   fileFormat     n ##   <chr>      <int> ## 1 fastq        800"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9fc0064b-84ce-40a5-a768-e6eb3d364ee0.html","id":"anomalies","dir":"Articles","previous_headings":"","what":"Anomalies","title":"Case Study: Single-cell RNA-seq reveals cell type-specific molecular and genetic associations to lupus","text":"count summary files.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/articles/hca-9fc0064b-84ce-40a5-a768-e6eb3d364ee0.html","id":"sessioninfo","dir":"Articles","previous_headings":"","what":"sessionInfo()","title":"Case Study: Single-cell RNA-seq reveals cell type-specific molecular and genetic associations to lupus","text":"","code":"sessionInfo() ## R version 4.2.1 Patched (2022-10-03 r83008) ## Platform: aarch64-apple-darwin21.6.0 (64-bit) ## Running under: macOS Monterey 12.6 ##  ## Matrix products: default ## BLAS:   /Users/ma38727/bin/R-4-2-branch/lib/libRblas.dylib ## LAPACK: /Users/ma38727/bin/R-4-2-branch/lib/libRlapack.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] dplyr_1.0.10              hca_1.5.7                 ## [3] hcaCaseStudies_0.0.0.9005 BiocStyle_2.25.0          ##  ## loaded via a namespace (and not attached): ##  [1] Rcpp_1.0.9          lattice_0.20-45     tidyr_1.2.1         ##  [4] assertthat_0.2.1    rprojroot_2.0.3     digest_0.6.29       ##  [7] utf8_1.2.2          mime_0.12           BiocFileCache_2.5.0 ## [10] R6_2.5.1            RSQLite_2.2.18      evaluate_0.16       ## [13] httr_1.4.4          pillar_1.8.1        rlang_1.0.6         ## [16] curl_4.3.2          miniUI_0.1.1.1      whisker_0.4         ## [19] jquerylib_0.1.4     blob_1.2.3          Matrix_1.5-1        ## [22] DT_0.25             rmarkdown_2.16      pkgdown_2.0.6       ## [25] textshaping_0.3.6   desc_1.4.2          readr_2.1.3         ## [28] stringr_1.4.1       htmlwidgets_1.5.4   bit_4.0.4           ## [31] shiny_1.7.2         compiler_4.2.1      httpuv_1.6.6        ## [34] xfun_0.33           pkgconfig_2.0.3     systemfonts_1.0.4   ## [37] htmltools_0.5.3     tidyselect_1.1.2    tibble_3.1.8        ## [40] bookdown_0.29       codetools_0.2-18    fansi_1.0.3         ## [43] tzdb_0.3.0          dbplyr_2.2.1        later_1.3.0         ## [46] rappdirs_0.3.3      grid_4.2.1          jsonlite_1.8.2      ## [49] xtable_1.8-4        lifecycle_1.0.2     DBI_1.1.3           ## [52] magrittr_2.0.3      cli_3.4.1           stringi_1.7.8       ## [55] cachem_1.0.6        fs_1.5.2            promises_1.2.0.1    ## [58] bslib_0.4.0         ellipsis_0.3.2      filelock_1.0.2      ## [61] ragg_1.2.3          generics_0.1.3      vctrs_0.4.2         ## [64] tools_4.2.1         bit64_4.0.5         glue_1.6.2          ## [67] purrr_0.3.5         hms_1.1.2           fastmap_1.1.0       ## [70] yaml_2.3.5          BiocManager_1.30.18 memoise_2.0.1       ## [73] knitr_1.40          sass_0.4.2"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Martin Morgan. Author, maintainer.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Morgan M (2022). hcaCaseStudies: Case Studies Using Data Human Cell Atlas. R package version 0.0.0.9004, https://mtmorgan.github.io/hcaCaseStudies/.","code":"@Manual{,   title = {hcaCaseStudies: Case Studies Using Data from the Human Cell Atlas},   author = {Martin Morgan},   year = {2022},   note = {R package version 0.0.0.9004},   url = {https://mtmorgan.github.io/hcaCaseStudies/}, }"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/cache.html","id":null,"dir":"Reference","previous_headings":"","what":"Cache of Computationally Expensive Objects for Reuse — cache","title":"Cache of Computationally Expensive Objects for Reuse — cache","text":"cache() creates / returns 'BiocFileCache' object containing information objects package-specific cache. cache_exists() tests whether object exists cache. object identified concatentation project_id object_name argument. cache_list() summarizes project objects available cache. cache_add() adds object cache, using project_id object_name create identifier. writer_function used save object cache. cache_read() retrieves object cache, using project_id object_name create identifier. reader_function used read object R. cache_remove() removes object cache.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/cache.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Cache of Computationally Expensive Objects for Reuse — cache","text":"","code":"cache(create = TRUE)  cache_exists(project_id, object_name)  cache_list()  cache_add(   object,   project_id,   object_name,   writer_function = saveRDS,   ...,   overwrite = FALSE )  cache_read(project_id, object_name, reader_function = readRDS, ...)  cache_remove(project_id, object_name)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/cache.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Cache of Computationally Expensive Objects for Reuse — cache","text":"create logical(1) create cache exist? Default: TRUE. project_id character(1) project identifier, e.g., \"3c9d586e-bd26-4b46-8690-3faaa18ccf38\". object_name character(1) arbitrary object identifier. Cached objects created Case Study vignettes prefixed \"local.\", e.g., \"local.countMatrix\". object R object. writer_function function taking first argument object, second argument cache file path (determined internally) store object, additional arguments (... cache_add()) required write object. ... cache_read(), ... arguments passed 'reader_function()`. overwrite logical(1) overwrite existing object cache? default FALSE, attempts write object result error. reader_function function taking first argument cache file path (determined internally) object, additional arguments (... cache_add()) required write object.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/cache.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Cache of Computationally Expensive Objects for Reuse — cache","text":"cache() returns BiocFileCache object can manipulated using interface defined BiocFileCache package. cache_exists() returns logical(1) value, TRUE object identified projectId object_name exists cache. cache_list() returns tibble two columns: project_id object_name objects cache. can use , e.g., cache_read() cache_remove(). cache_add() returns, invisibly, cache file path object stored. cache_read() returns value returned reader_function(). cache_remove() warns object cache, returns FALSE invisibly, removes object returns TRUE invisibly.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/cache.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Cache of Computationally Expensive Objects for Reuse — cache","text":"","code":"cache() #> class: BiocFileCache #> bfccache: /Users/ma38727/Library/Caches/org.R-project.R/R/hcaCaseStudies #> bfccount: 6 #> For more information see: bfcinfo() or bfcquery()  faux_project_id <- \"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\" faux_object_name <- \"local.fauxObject\"  cache_exists(faux_project_id, faux_object_name) #> [1] FALSE  cache_list() #> # A tibble: 5 × 2 #>   project_id                           object_name       #>   <chr>                                <chr>             #> 1 5b910a43-7fb5-4ea7-b9d6-43dbd1bf2776 local.countMatrix #> 2 3c9d586e-bd26-4b46-8690-3faaa18ccf38 local.countMatrix #> 3 9ac53858-606a-4b89-af49-804ccedaa660 local.countMatrix #> 4 8f630e0f-6bf9-4a04-9754-02533152a954 local.countMatrix #> 5 9a23ac2d-93dd-4bac-9bb8-040e6426db9d local.countMatrix  cache_exists(faux_project_id, faux_object_name)       # FALSE #> [1] FALSE cache_add(letters, faux_project_id, faux_object_name) cache_exists(faux_project_id, faux_object_name)       # TRUE #> [1] TRUE  cache_read(faux_project_id, faux_object_name) #>  [1] \"a\" \"b\" \"c\" \"d\" \"e\" \"f\" \"g\" \"h\" \"i\" \"j\" \"k\" \"l\" \"m\" \"n\" \"o\" \"p\" \"q\" \"r\" \"s\" #> [20] \"t\" \"u\" \"v\" \"w\" \"x\" \"y\" \"z\"  cache_remove(faux_project_id, faux_object_name) cache_exists(faux_project_id, faux_object_name)       # FALSE #> [1] FALSE"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/column.html","id":null,"dir":"Reference","previous_headings":"","what":"Tests on Column Content — column_is_not_all_NA","title":"Tests on Column Content — column_is_not_all_NA","text":"column_is_not_all_NA() tests whether elements column x NA (undefined). column_is_informative() returns TRUE column x contains values differ across rows, hence informative status row. column_is_experimentwide() returns TRUE column x NA, values column unique.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/column.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Tests on Column Content — column_is_not_all_NA","text":"","code":"column_is_not_all_NA(x)  column_is_informative(x)  column_is_experimentwide(x)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/column.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Tests on Column Content — column_is_not_all_NA","text":"x R vector .na() defined.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/column.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Tests on Column Content — column_is_not_all_NA","text":"column_is_not_all_NA() returns TRUE elements x NA, FALSE otherwise.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/column.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Tests on Column Content — column_is_not_all_NA","text":"","code":"example_tbl <- dplyr::tibble(     x = letters,     y = c(NA, tail(letters, -1)),     z = rep(NA, length(letters)),     w = \"A\" ) example_tbl |>     dplyr::select(where(column_is_not_all_NA))     # x, y, w #> # A tibble: 26 × 3 #>    x     y     w     #>    <chr> <chr> <chr> #>  1 a     NA    A     #>  2 b     b     A     #>  3 c     c     A     #>  4 d     d     A     #>  5 e     e     A     #>  6 f     f     A     #>  7 g     g     A     #>  8 h     h     A     #>  9 i     i     A     #> 10 j     j     A     #> # … with 16 more rows  example_tbl |>     dplyr::select(where(column_is_informative))    # x, y #> # A tibble: 26 × 2 #>    x     y     #>    <chr> <chr> #>  1 a     NA    #>  2 b     b     #>  3 c     c     #>  4 d     d     #>  5 e     e     #>  6 f     f     #>  7 g     g     #>  8 h     h     #>  9 i     i     #> 10 j     j     #> # … with 16 more rows  example_tbl |>     dplyr::select(where(column_is_experimentwide)) # w #> # A tibble: 26 × 1 #>    w     #>    <chr> #>  1 A     #>  2 A     #>  3 A     #>  4 A     #>  5 A     #>  6 A     #>  7 A     #>  8 A     #>  9 A     #> 10 A     #> # … with 16 more rows"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/csv_tsv.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize Tab- or Comma-Separated Files — csv_tsv_gz_count_lines","title":"Summarize Tab- or Comma-Separated Files — csv_tsv_gz_count_lines","text":"csv_tsv_gz_count_lines() counts number lines one several comma- tab-delimited files.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/csv_tsv.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize Tab- or Comma-Separated Files — csv_tsv_gz_count_lines","text":"","code":"csv_tsv_gz_count_lines(.data, file_id = \"fileId\", file_path = \"local.filePath\")"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/csv_tsv.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize Tab- or Comma-Separated Files — csv_tsv_gz_count_lines","text":".data tibblecontaining column withfile_idandfile_path` columns. file_id character(1) column name .data containing (unique) identifier files line counts requested. file_path character(1) column name .data containing file paths file lines counted.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/csv_tsv.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize Tab- or Comma-Separated Files — csv_tsv_gz_count_lines","text":"csv_tsv_gz_count_lines() returns original tibble .data additional column local.lines containing number lines file_path.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/geo.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize GEO Files — geo_gsm_cell_count","title":"Summarize GEO Files — geo_gsm_cell_count","text":"geo_gsm_cell_count() parses GEO GSM file number cells present file. geo_gsm_gene_count() parses GEO GSM file number genes present file. geo_gsm_count_matrix() returns sparse matrix gene x cell counts.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/geo.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize GEO Files — geo_gsm_cell_count","text":"","code":"geo_gsm_cell_count(.data, sep = \"\\\\t\")  geo_gsm_gene_count(.data)  geo_gsm_count_matrix(.data, reader_function = readr::read_tsv)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/geo.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize GEO Files — geo_gsm_cell_count","text":".data files_tbl_hca object (e.g., created hca::files()) containing fileId local.filePath columns. rows .data must refer GSM files. sep character(1) single character used separate fields GSM file. Typically tab ('\\\\t\", default) comma \",\". reader_function function read GSM file. function come readr package. default read_tsv appropriate tab-delimited CSV files; common alternative read_csv comma-separated GSM files.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/geo.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize GEO Files — geo_gsm_cell_count","text":"geo_gsm_cell_count() returns .data augmented column local.cellCount reporting number cells file. geo_gsm_gene_count() returns .data augmented column gene counts, \"local.geneCount\". geo_gsm_count_matrix() returns sparse matrix rows (genes) equal unique genes input files, columns (cells) equal total cell count GSM files. Samples order present .data.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/geo.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Summarize GEO Files — geo_gsm_cell_count","text":"geo_gsm_cell_count() parses first line GSM file, assuming line 'header' gene first column cell labels subsequent columns. number cells number columns file minus 1. geo_gsm_gene_count() counts number lines file, reports number genes number minus one, assuming first line 'header' line. geo_gsm_count_matrix() parses GEO GSM file turn, assuming file contains dense matrix. dense matrix converted sparse representation. file processed, new genes appended original index, cells appended j index. final result concatenation sparse matrix representations. Progress reports amount memory currently consumed cummulating object.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/mtx.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize 'MatrixMart' files — mtx_count_matrix","title":"Summarize 'MatrixMart' files — mtx_count_matrix","text":"mtx_count_matrix() parses one several MatrixMart files identical dimensions single dgCMatrix object.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/mtx.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize 'MatrixMart' files — mtx_count_matrix","text":"","code":"mtx_count_matrix(   .data,   mtx_path,   genes_path = NULL,   barcodes_path = NULL,   sep = \"\\t\" )"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/mtx.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize 'MatrixMart' files — mtx_count_matrix","text":".data tibble containing column value mtx_path parameter , non-NULL, columns value parameters genes_path barcodes_path. mtx_path character() paths MatrixMart files disk. genes_path character() (optional) paths files containing gene (row) labels (e.g., ENSEMBL gene identifiers). row labels must first column file; fields separated parameter sep; can column headers file. barcodes_path character() (optional) paths files containing cell (column) labels (e.g., barcodes). column labels must first column file; fields separated parameter sep; can column headers file. sep character(1), default \"\\t\" (tab). Field separator genes_path barcodes_path files.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/mtx.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize 'MatrixMart' files — mtx_count_matrix","text":"mtx_count_matrix() returns dgCMatrix sparse matrix rows (genes) equal unique genes input files, columns (cells) equal total cell count MatrixMart files. Samples (columns) order present .data.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/project.html","id":null,"dir":"Reference","previous_headings":"","what":"Project-related Queries — project_information","title":"Project-related Queries — project_information","text":"project_information() queries HCA databasee project title, description, contact, DOI, publication URI. project_title() returns title project, cleaned remove trailing trailing .. print.project_information() formats result project_information() legible manner.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/project.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Project-related Queries — project_information","text":"","code":"project_information(project_id)  project_title(project_id)  # S3 method for project_information print(x, ...)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/project.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Project-related Queries — project_information","text":"project_id character(1) project identifier, e.g., \"3c9d586e-bd26-4b46-8690-3faaa18ccf38\". x object class project_information, result call project_information(). ... additional arguments, required conform print generic used.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/project.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Project-related Queries — project_information","text":"project_information() returns tibble single row, columns containing information project. tibble class project_information printed interactive session formatted long columns, e.g., projectDescription, easily read. project_title() returns character(1) vector containing project title. print.project_information() invoked automatically result project_information() displayed side effect displaying object.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/project.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Project-related Queries — project_information","text":"","code":"project_id <- \"3c9d586e-bd26-4b46-8690-3faaa18ccf38\" project_information(project_id) #> Title #>   Highly Parallel Genome-wide Expression Profiling of Individual Cells #>   Using Nanoliter Droplets #> Contributors (unknown order; any role) #>   Joshua R Sanes, Rahul Satija, Alex K Shalek, Anindita Basu, James #>   Nemesh, Itay Tirosh, John J Trombetta, Aviv Regev, Ami Day, Evan Z #>   Macosko, Karthik Shekhar, Allison R Bialas, Steven A McCarroll, David #>   A Weitz, Nolan Kamitaki, Emily M Martersteck, Melissa Goldman #> Description #>   Cells, the basic units of biological structure and function, vary #>   broadly in type and state. Single-cell genomics can characterize cell #>   identity and function, but limitations of ease and scale have #>   prevented its broad application. Here we describe Drop-seq, a #>   strategy for quickly profiling thousands of individual cells by #>   separating them into nanoliter-sized aqueous droplets, associating a #>   different barcode with each cell's RNAs, and sequencing them all #>   together. Drop-seq analyzes mRNA transcripts from thousands of #>   individual cells simultaneously while remembering transcripts' cell #>   of origin. We analyzed transcriptomes from 44,808 mouse retinal cells #>   and identified 39 transcriptionally distinct cell populations, #>   creating a molecular atlas of gene expression for known retinal cell #>   classes and novel candidate cell subtypes. Drop-seq will accelerate #>   biological discovery by enabling routine transcriptional profiling at #>   single-cell resolution. #> doi: 10.1016/j.cell.2015.05.002 #> url: https://www.cell.com/fulltext/S0092-8674(15)00549-8 #> project: https://data.humancellatlas.org/explore/projects/3c9d586e-bd26-4b46-8690-3faaa18ccf38  project_title(project_id) #> [1] \"Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets\""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/use_template.html","id":null,"dir":"Reference","previous_headings":"","what":"Templates For New Case Studies — use_template","title":"Templates For New Case Studies — use_template","text":"use_template() creates new R markdown file starting point case study. file requires manual editing customize specific project.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/use_template.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Templates For New Case Studies — use_template","text":"","code":"use_template(project_id, case_study_path, overwrite = FALSE)"},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/use_template.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Templates For New Case Studies — use_template","text":"project_id character(1) project identifier, e.g., \"3c9d586e-bd26-4b46-8690-3faaa18ccf38\". case_study_path character(1) path directory case study created. overwrite logical(1) overwrite case study created function project_id case_study_path? Default: FALSE.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/use_template.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Templates For New Case Studies — use_template","text":"use_template() returns path rendered template (case_study_path) approriate substitution variables.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/use_template.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Templates For New Case Studies — use_template","text":"use_template() queries HCA data portal project title associated project_id, uses title vignette index entry rendered markdown doeucment. project_id injected document, references project_id defined. Rendering template also injects current date, package name, package version.","code":""},{"path":"https://mtmorgan.github.io/hcaCaseStudies/reference/use_template.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Templates For New Case Studies — use_template","text":"","code":"project_id <- \"3c9d586e-bd26-4b46-8690-3faaa18ccf38\" case_study_path <- tempfile(); dir.create(case_study_path) rmd <- use_template(project_id, case_study_path) readLines(rmd) |>     head() |>     noquote() #> [1] ---                                                                                                                #> [2] title: \"Case Study: Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets\" #> [3] author:                                                                                                            #> [4]   - name: Martin Morgan                                                                                            #> [5]     affiliation:                                                                                                   #> [6]     - Roswell Park Comprehensive Cancer Center"}]
